import{j as t,m}from"./framer-BMT5hQ7X.js";import{u as G,r as s}from"./router-DOtJe_Np.js";import{u as O,s as u}from"./index-D-UdPBaI.js";import{S as H}from"./SpotCard-zv2mAJ2R.js";import"./SkeletonLoader-D7onCYtA.js";import{a as E,M as X,X as Y,T as J,b as Q}from"./lucide-DqyMvtym.js";import"./vendor-b0vXyz-r.js";import"./supabase-CtFrdYha.js";import"./ImageSlider-D9DlSLMK.js";const de=({lang:P})=>{const B=G(),{user:R}=O(),[S,q]=s.useState([]),[Z,L]=s.useState(!0),[l,M]=s.useState(""),[c,z]=s.useState(null),[D,_]=s.useState("All Kerala"),[K,T]=s.useState(!1),[d,W]=s.useState(""),[x,I]=s.useState(!1),[C,V]=s.useState([]),[k,N]=s.useState([]);s.useEffect(()=>{(async()=>{L(!0);try{await Promise.all([p(),j(),w()])}finally{L(!1)}})();const o=u.channel("home_spots_changes").on("postgres_changes",{event:"UPDATE",schema:"public",table:"spots",filter:"is_verified=eq.true"},i=>{console.log("Home page received real-time update:",i),i.new.is_verified&&(p(),j(),w())}).subscribe(),a=u.channel("home_ratings_changes").on("postgres_changes",{event:"*",schema:"public",table:"spot_ratings"},i=>{console.log("Home page received rating change:",i),p(),j(),w()}).subscribe(),n=i=>{console.log("Home page received custom verification event:",i.detail),p()};return window.addEventListener("spotVerified",n),()=>{o.unsubscribe(),a.unsubscribe(),window.removeEventListener("spotVerified",n)}},[c]);const j=async()=>{const e=new Date(Date.now()-6048e5),{data:o}=await u.from("spots").select("*").eq("is_verified",!0).gte("created_at",e.toISOString()).order("created_at",{ascending:!1}).limit(5);V(o||[])},w=async()=>{const{data:e}=await u.from("spots").select("*").eq("is_verified",!0).order("created_at",{ascending:!1}).limit(5);N(e||[])},p=async()=>{const{data:e,error:o}=await u.from("spots").select("*").eq("is_verified",!0).order("created_at",{ascending:!1});if(o)console.error("Error fetching spots:",o);else{let a=e||[];c&&(a=a.filter(n=>F(c.lat,c.lng,n.latitude,n.longitude)<=30)),q(a)}};s.useMemo(()=>{if(!l.trim()||l.trim().length<2)return S;const e=l.toLowerCase().trim();return S.filter(a=>{const n=a.name&&a.name.toLowerCase().includes(e),i=a.location&&a.location.toLowerCase().includes(e);let h=!1;return a.tags&&Array.isArray(a.tags)&&a.tags.length>0&&(h=a.tags.some(g=>{if(!g)return!1;const r=g.toLowerCase(),f=r.replace(/\s+/g,""),y=r.replace(/\s+/g,"-"),$=r.replace(/-/g,""),v=e.replace(/\s+/g,""),b=e.replace(/\s+/g,"-");return e.length>=2&&r.includes(e)||v.length>=2&&f.includes(v)||b.length>=2&&y.includes(b)||e.length>=2&&$.includes(e)||e.length>=2&&e.includes(r)||v.length>=2&&v.includes(f)||b.length>=2&&b.includes(y)})),n||i||h})},[S,l]);function F(e,o,a,n){var i=6371,h=(a-e)*Math.PI/180,g=(n-o)*Math.PI/180,r=Math.sin(h/2)*Math.sin(h/2)+Math.cos(e*Math.PI/180)*Math.cos(a*Math.PI/180)*Math.sin(g/2)*Math.sin(g/2),f=2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)),y=i*f;return y}const A=async()=>{if(d.trim()){I(!0);try{const o=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(d+", Kerala, India")}&limit=1`)).json();if(o&&o.length>0){const a={lat:parseFloat(o[0].lat),lng:parseFloat(o[0].lon),name:o[0].display_name.split(",")[0]};console.log("Location found:",a),z(a),_(a.name),T(!1),p()}else console.log("No location found for:",d)}catch(e){console.error("Error searching location:",e)}finally{I(!1)}}},U=()=>{z(null),_("All Kerala"),W("")};return t.jsx("div",{style:{paddingBottom:"100px",background:"var(--bg-main)",minHeight:"100vh"},children:t.jsxs("div",{className:"container",style:{padding:"0 16px",maxWidth:"100%",boxSizing:"border-box"},children:[t.jsxs("header",{style:{marginBottom:"24px"},children:[t.jsxs("p",{style:{margin:0,fontSize:"1rem",color:"var(--text-muted)"},children:["Hello ",R?.user_metadata?.full_name?.split(" ")[0]||"Foodie",","]}),t.jsx("h1",{style:{margin:"4px 0",fontSize:"1.6rem",fontWeight:"900",color:"var(--text-main)"},children:"What do you want to eat today?"})]}),t.jsxs("div",{style:{position:"relative",marginBottom:"24px"},children:[t.jsx("input",{type:"text",placeholder:"Search dishes, restaurants...",value:l,onChange:e=>{const o=e.target.value;o==="#admin"?(B(`/${P}/admin`),M("")):M(o)},style:{width:"100%",padding:"16px 20px 16px 50px",borderRadius:"var(--radius-lg)",border:"none",background:"var(--secondary)",fontSize:"1rem",fontWeight:"600"}}),t.jsx(E,{size:22,color:"var(--text-muted)",style:{position:"absolute",left:"16px",top:"50%",transform:"translateY(-50%)"}})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"20px"},children:[t.jsxs(m.button,{whileTap:{scale:.95},onClick:()=>T(!K),style:{background:"rgba(239, 42, 57, 0.1)",color:"var(--primary)",padding:"8px 16px",borderRadius:"12px",fontSize:"0.85rem",fontWeight:"800",display:"flex",alignItems:"center",gap:"6px",border:"none",cursor:"pointer",transition:"all 0.3s ease",flexShrink:0},children:[t.jsx(X,{size:16})," ",D]}),t.jsx("div",{style:{flex:1,minWidth:"200px"},children:t.jsxs("div",{style:{position:"relative"},children:[t.jsx("input",{type:"text",placeholder:"Search location in Kerala...",value:d,onChange:e=>W(e.target.value),onKeyPress:e=>e.key==="Enter"&&A(),style:{width:"100%",padding:"0 70px 0 45px",borderRadius:"25px",border:"2px solid var(--primary)",background:"var(--bg-white)",fontSize:"0.85rem",fontWeight:"600",boxShadow:"0 4px 15px rgba(239, 42, 57, 0.15)",transition:"all 0.3s ease",boxSizing:"border-box",lineHeight:"44px"}}),t.jsx(E,{size:20,color:"var(--primary)",style:{position:"absolute",left:"15px",top:"12px",zIndex:2}}),t.jsx(m.button,{whileTap:{scale:.95},onClick:A,disabled:x,style:{position:"absolute",right:"8px",top:"7px",background:"var(--primary)",color:"white",border:"none",padding:"8px 16px",borderRadius:"20px",fontSize:"0.75rem",fontWeight:"700",cursor:x?"not-allowed":"pointer",opacity:x?.6:1,boxShadow:"0 2px 8px rgba(239, 42, 57, 0.3)",zIndex:2,height:"30px"},children:x?"...":"Go"}),d&&t.jsx(m.button,{whileTap:{scale:.95},onClick:U,style:{position:"absolute",right:"70px",top:"7px",background:"transparent",color:"#6b7280",border:"none",padding:"8px",borderRadius:"20px",fontSize:"0.75rem",fontWeight:"700",cursor:"pointer",zIndex:2,height:"30px"},children:t.jsx(Y,{size:16})})]})})]}),C.length>0&&!c&&!l.trim()&&t.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},style:{marginBottom:"30px"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[t.jsx(J,{size:24,color:"var(--primary)"}),t.jsx("h3",{style:{fontSize:"1.3rem",fontWeight:"800",color:"var(--text-main)"},children:"Trending This Week"})]}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"16px"},children:C.map(e=>t.jsx(H,{spot:e},e.id))})]}),k.length>0&&!c&&!l.trim()&&t.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.6},style:{marginBottom:"30px"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[t.jsx(Q,{size:24,color:"var(--primary)"}),t.jsx("h3",{style:{fontSize:"1.3rem",fontWeight:"800",color:"var(--text-main)"},children:"Popular Spots"})]}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"16px"},children:k.map(e=>t.jsx(H,{spot:e},e.id))})]})]})})};export{de as default};
