import{r as f,u as E,a as T,R as p,s as l,j as e,m as h,S as v,H as L}from"./index-COh0nrvB.js";import{I as P}from"./ImageSlider-fNb6Fewz.js";const X=f.memo(({spot:s})=>{const{name:y,average_rating:g,total_ratings:b,images:w,distance:j,tags:S,price_level:_,id:a,instagram_handle:$,whatsapp_number:A}=s,F=E(),{user:n}=T(),[K,k]=p.useState(!1),[x,u]=p.useState(!1),[V,R]=p.useState(0),[d,m]=p.useState(null),z=t=>({1:"₹50-150",2:"₹150-300",3:"₹300-600",4:"₹600+"})[t]||"₹50-150";f.useEffect(()=>{let t=!0;return a&&(W(t),C(t),s.opening_hours?m(I(s.opening_hours)):m(null)),()=>{t=!1}},[a,n,s.opening_hours]);const C=async t=>{if(!n)return;const{data:i}=await l.from("user_favorites").select("*").eq("spot_id",a).eq("user_id",n.id).maybeSingle();t&&u(!!i)},D=async t=>{if(t.stopPropagation(),!n)return;const i=x;u(!i);try{i?await l.from("user_favorites").delete().eq("spot_id",a).eq("user_id",n.id):await l.from("user_favorites").insert({spot_id:a,user_id:n.id})}catch{u(i)}},H=()=>new Date(new Date().toLocaleString("en-US",{timeZone:"Asia/Kolkata"})),I=t=>{if(!t||!t.open||!t.close)return null;const i=H(),[c,O=0]=t.open.split(":").map(Number),[N,B=0]=t.close.split(":").map(Number),r=new Date(i);r.setHours(c,O,0,0);const o=new Date(i);return o.setHours(N,B,0,0),o<=r&&(i<r?r.setDate(r.getDate()-1):o.setDate(o.getDate()+1)),i>=r&&i<=o},W=async t=>{try{const{count:i}=await l.from("visited_spots").select("*",{count:"exact",head:!0}).eq("spot_id",a);if(t&&R(i||0),n){const{data:c}=await l.from("visited_spots").select("user_id").eq("spot_id",a).eq("user_id",n.id).maybeSingle();t&&k(!!c)}}catch(i){console.error(i)}},q=()=>{const t=window.location.pathname.includes("/ml/")?"ml":"en";F(`/${t}/spot/${a}`)};return e.jsxs(h.div,{initial:{opacity:0,y:15},animate:{opacity:1,y:0},whileHover:{y:-5},transition:{duration:.3},onClick:q,style:{background:"var(--bg-white)",borderRadius:"var(--radius-lg)",padding:"8px",boxShadow:"var(--shadow-md)",cursor:"pointer",marginBottom:"8px",display:"flex",flexDirection:"column",gap:"6px",width:"100%",maxWidth:"100%",boxSizing:"border-box"},children:[e.jsxs("div",{style:{position:"relative",height:"120px",borderRadius:"20px",overflow:"hidden"},onClick:t=>t.stopPropagation(),children:[e.jsx(P,{images:w,interval:4e3}),e.jsxs("div",{style:{position:"absolute",top:"6px",left:"50%",transform:"translateX(-50%)",background:d===null?"rgba(100, 116, 139, 0.7)":d?"rgba(16, 185, 129, 0.9)":"rgba(239, 68, 68, 0.9)",backdropFilter:"blur(8px)",color:"white",padding:"3px 8px",borderRadius:"16px",fontSize:"0.55rem",fontWeight:"800",display:"flex",alignItems:"center",gap:"3px"},children:[e.jsx("div",{style:{width:"4px",height:"4px",borderRadius:"50%",background:"white"}}),d===null?"HOURS N/A":d?"OPEN":"CLOSED"]}),e.jsx("div",{style:{position:"absolute",bottom:"6px",left:"6px",background:"white",padding:"2px 6px",borderRadius:"8px",display:"flex",alignItems:"center",gap:"3px",fontSize:"0.65rem",fontWeight:"800"},children:g&&b>0?e.jsxs(e.Fragment,{children:[e.jsx(v,{size:8,fill:"#FFB800",color:"#FFB800"}),e.jsx("span",{style:{marginLeft:"2px"},children:g.toFixed(1)})]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{size:8,fill:"#FFB800",color:"#FFB800"}),e.jsx("span",{children:"New"})]})})]}),e.jsxs("div",{style:{padding:"0 2px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{style:{flex:1,minWidth:0,marginRight:"8px"},children:[e.jsx("h3",{style:{fontSize:"0.85rem",fontWeight:"900",margin:"0 0 2px 0",color:"var(--text-main)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",lineHeight:"1.2"},children:y}),e.jsxs("p",{style:{fontSize:"0.7rem",color:"var(--text-muted)",margin:0,lineHeight:"1.2"},children:[j," km"]})]}),e.jsx(h.button,{whileTap:{scale:.8},onClick:D,style:{background:"none",border:"none",cursor:"pointer",padding:"2px",flexShrink:0},children:e.jsx(L,{size:18,fill:x?"var(--primary)":"none",color:x?"var(--primary)":"var(--text-muted)"})})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"8px"},children:[e.jsx("div",{style:{display:"flex",gap:"4px"},children:(S||[]).slice(0,1).map((t,i)=>e.jsxs("span",{style:{fontSize:"0.65rem",color:"var(--primary)",fontWeight:"700"},children:["#",t]},i))}),e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:"900",color:"var(--primary)",background:"rgba(239, 42, 57, 0.1)",padding:"4px 8px",borderRadius:"8px"},children:z(_)})]}),e.jsx("div",{style:{marginTop:"6px",fontSize:"0.7rem",color:"var(--text-muted)",fontWeight:"700"},children:s.opening_hours?.open&&s.opening_hours?.close?`Kerala time: ${s.opening_hours.open} - ${s.opening_hours.close}`:"Hours not set"})]})]})});export{X as S};
