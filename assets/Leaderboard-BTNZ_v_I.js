import{j as e,m as o,A as z}from"./framer-BMT5hQ7X.js";import{u as P,r as l}from"./router-DOtJe_Np.js";import{s as n}from"./index-DkSLAsqm.js";import{l as C,s as I,t as R,U as E,S as L,X as U}from"./lucide-DqyMvtym.js";import"./vendor-b0vXyz-r.js";import"./supabase-CtFrdYha.js";const M=()=>{const b=P(),[u,y]=l.useState([]),[v,h]=l.useState(!0),[j,d]=l.useState(!1);l.useEffect(()=>{c(),setTimeout(()=>{d(!0)},2e3);const i=()=>{c()};window.addEventListener("userProfileUpdated",i);const s=n.channel("user_preferences_changes_leaderboard").on("postgres_changes",{event:"UPDATE",schema:"public",table:"user_preferences"},a=>{c()}).subscribe();return()=>{window.removeEventListener("userProfileUpdated",i),n.removeChannel(s)}},[]);const c=async()=>{h(!0);const{data:i}=await n.from("spots").select("created_by"),{data:s}=await n.from("reviews").select("user_id"),a={};i?.forEach(t=>{const r=t.created_by;r&&(a[r]||(a[r]={spots:0,reviews:0,xp:0}),a[r].spots+=1,a[r].xp+=100)}),s?.forEach(t=>{const r=t.user_id;r&&(a[r]||(a[r]={spots:0,reviews:0,xp:0}),a[r].reviews+=1,a[r].xp+=10)});const g=Object.keys(a),{data:w}=await n.from("user_preferences").select("user_id, username, display_name, avatar_url").in("user_id",g),{data:{user:p}}=await n.auth.getUser(),x={};w?.forEach(t=>x[t.user_id]=t);const f=new Set;Object.values(x).forEach(t=>{const r=["admin","sinxn","moderator"],_=(t.username||"").toLowerCase(),k=(t.display_name||"").toLowerCase();r.some(m=>_.includes(m)||k.includes(m))&&f.add(t.user_id)});const S=g.filter(t=>!f.has(t)).map(t=>{const r=x[t];return{id:t,name:r?.display_name||r?.username||p?.user_metadata?.full_name||"Foodie",avatar:r?.avatar_url,isMe:p&&t===p.id,...a[t]}}).sort((t,r)=>r.xp-t.xp);y(S),h(!1)};return e.jsxs("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #fef3c7 0%, #fbbf24 50%, #f59e0b 100%)",paddingBottom:"120px"},children:[e.jsxs("div",{style:{height:"180px",background:"linear-gradient(135deg, #f59e0b, #d97706)",borderBottomLeftRadius:"40px",borderBottomRightRadius:"40px",padding:"24px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",boxShadow:"0 8px 32px rgba(245, 158, 11, 0.3)"},children:[e.jsx("button",{onClick:()=>b(-1),style:{position:"absolute",left:"20px",top:"30px",background:"rgba(255,255,255,0.2)",border:"none",padding:"10px",borderRadius:"15px",color:"white"},children:e.jsx(C,{size:24})}),e.jsx(I,{size:48,color:"white",style:{marginBottom:"8px"}}),e.jsx("h1",{style:{color:"white",fontWeight:"900",fontSize:"1.6rem",margin:0},children:"Top Foodies"}),e.jsx("p",{style:{color:"rgba(255,255,255,0.8)",fontSize:"0.9rem",fontWeight:"600"},children:"Kerala's most active explorers"})]}),e.jsx("div",{className:"container",style:{padding:"0 20px",marginTop:"-30px"},children:v?e.jsx("div",{style:{textAlign:"center",padding:"40px"},children:e.jsx(o.div,{animate:{rotate:360},transition:{repeat:1/0,duration:1},children:e.jsx(R,{size:40,color:"var(--primary)"})})}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:u.map((i,s)=>e.jsxs(o.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:s*.05},style:{background:s===0?"linear-gradient(135deg, rgba(254, 243, 199, 0.8), rgba(251, 191, 36, 0.8))":s===1?"linear-gradient(135deg, rgba(229, 231, 235, 0.8), rgba(209, 213, 219, 0.8))":"rgba(255,255,255,0.1)",padding:"16px",borderRadius:"24px",display:"flex",alignItems:"center",justifyContent:"space-between",boxShadow:"0 4px 20px rgba(0,0,0,0.1)",backdropFilter:"blur(10px)",border:i.isMe?"2px solid #f59e0b":"1px solid rgba(255,255,255,0.2)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[e.jsx("div",{style:{width:"28px",fontWeight:"900",color:s<3?"#f59e0b":"#6b7280",fontSize:"1.1rem"},children:s===0?"ðŸ¥‡":s===1?"ðŸ¥ˆ":s===2?"ðŸ¥‰":`#${s+1}`}),e.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"16px",background:"linear-gradient(135deg, #f59e0b, #d97706)",overflow:"hidden"},children:i.avatar?e.jsx("img",{src:i.avatar,style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(E,{size:24,color:"white"})})}),e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:"800",fontSize:"1rem",color:i.isMe?"#f59e0b":"#1f2937"},children:[i.name," ",i.isMe&&"(You!)"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"#6b7280",fontWeight:"600"},children:[i.spots," Spots shared"]})]})]}),e.jsxs("div",{style:{background:"linear-gradient(135deg, #f59e0b, #d97706)",padding:"8px 16px",borderRadius:"14px",fontWeight:"900",color:"white",fontSize:"0.9rem",boxShadow:"0 4px 20px rgba(245, 158, 11, 0.3)"},children:[i.xp," XP"]})]},i.id))})}),e.jsx(z,{children:j&&e.jsxs(e.Fragment,{children:[e.jsx(o.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",zIndex:9998,backdropFilter:"blur(4px)"},onClick:()=>d(!1)}),e.jsxs(o.div,{initial:{opacity:0,y:-50,x:"-50%",scale:.95},animate:{opacity:1,y:0,x:"-50%",scale:1},exit:{opacity:0,y:-50,x:"-50%",scale:.95},style:{position:"fixed",top:"80px",left:"50%",transform:"translateX(-50%)",background:"white",padding:"32px",borderRadius:"24px",boxShadow:"0 20px 60px rgba(0,0,0,0.3)",zIndex:9999,maxWidth:"90vw",width:"400px",maxHeight:"80vh",overflow:"auto",boxSizing:"border-box"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{width:"48px",height:"48px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:"16px",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 12px rgba(102, 126, 234, 0.4)"},children:e.jsx(L,{size:24,color:"white"})}),e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,fontSize:"1.2rem",fontWeight:"900",color:"var(--text-main)"},children:"XP Points"}),e.jsx("p",{style:{margin:"8px 0 0 0",fontSize:"0.9rem",color:"var(--text-muted)",lineHeight:"1.4"},children:"Your XP points can be used for future features and rewards in the app! Keep exploring and reviewing to earn more XP."})]})]}),e.jsx(o.button,{whileTap:{scale:.9},onClick:()=>d(!1),style:{background:"none",border:"none",cursor:"pointer",padding:"8px",borderRadius:"12px",color:"var(--text-muted)"},children:e.jsx(U,{size:20})})]}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx(o.button,{whileTap:{scale:.95},onClick:()=>d(!1),style:{background:"var(--primary)",color:"white",border:"none",padding:"12px 24px",borderRadius:"16px",fontWeight:"800",fontSize:"1rem",cursor:"pointer",width:"100%"},children:"Got it! ðŸŽ®"})})]})]})})]})};export{M as default};
