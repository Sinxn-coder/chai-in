import{j as t,m}from"./framer-BMT5hQ7X.js";import{u as M,r as a}from"./router-DOtJe_Np.js";import{s as g}from"./index-BVTjrpxD.js";import{S as B}from"./SpotCard-BhuAYiIT.js";import{T as D}from"./Toast-BwML1H3D.js";import{a as F}from"./lucide-DqyMvtym.js";import"./vendor-b0vXyz-r.js";import"./supabase-CtFrdYha.js";import"./ImageSlider-D9DlSLMK.js";const P=({lang:v})=>{M();const[c,j]=a.useState([]),[w,h]=a.useState(!0),[s,b]=a.useState(""),[H,z]=a.useState([]),[R,T]=a.useState([]),[d,u]=a.useState(null);a.useEffect(()=>{C(),L(),W()},[]);const C=async()=>{h(!0);const{data:e,error:o}=await g.from("spots").select("*").eq("is_verified",!0).order("created_at",{ascending:!1});o?(console.error("Error fetching spots:",o),u({message:"Failed to load spots",type:"error"})):j(e||[]),h(!1)},L=async()=>{const e=new Date(Date.now()-6048e5),{data:o}=await g.from("spots").select("*").eq("is_verified",!0).gte("created_at",e.toISOString()).order("created_at",{ascending:!1}).limit(5);z(o||[])},W=async()=>{const{data:e}=await g.from("spots").select("*").eq("is_verified",!0).order("created_at",{ascending:!1}).limit(5);T(e||[])},p=a.useMemo(()=>{if(!s.trim()||s.trim().length<2)return c;const e=s.toLowerCase().trim();return c.filter(r=>{const _=r.name&&r.name.toLowerCase().includes(e),A=r.location&&r.location.toLowerCase().includes(e);let x=!1;return r.tags&&Array.isArray(r.tags)&&r.tags.length>0&&(x=r.tags.some(f=>{if(!f)return!1;const i=f.toLowerCase(),y=i.replace(/\s+/g,""),S=i.replace(/\s+/g,"-"),E=i.replace(/-/g,""),n=e.replace(/\s+/g,""),l=e.replace(/\s+/g,"-");return e.length>=2&&i.includes(e)||n.length>=2&&y.includes(n)||l.length>=2&&S.includes(l)||e.length>=2&&E.includes(e)||e.length>=2&&e.includes(i)||n.length>=2&&n.includes(y)||l.length>=2&&l.includes(S)})),_||A||x})},[c,s]);return t.jsxs("div",{style:{minHeight:"100vh",background:"var(--bg-cream)",padding:"20px"},children:[d&&t.jsx(D,{message:d.message,type:d.type,onClose:()=>u(null)}),t.jsx(m.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},style:{textAlign:"center",marginBottom:"30px"},children:s.trim()?t.jsxs(t.Fragment,{children:[t.jsx("h1",{style:{fontSize:"2rem",fontWeight:"900",color:"var(--primary)",marginBottom:"10px"},children:"Search Results"}),t.jsxs("p",{style:{color:"var(--text-muted)",fontSize:"1rem"},children:["Showing ",p.length,' spots for "',s,'"']})]}):t.jsxs(t.Fragment,{children:[t.jsx("h1",{style:{fontSize:"2rem",fontWeight:"900",color:"var(--primary)",marginBottom:"10px"},children:"Explore All Spots"}),t.jsx("p",{style:{color:"var(--text-muted)",fontSize:"1rem"},children:"Discover amazing food spots across Kerala"})]})}),t.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},style:{background:"white",padding:"20px",borderRadius:"20px",boxShadow:"var(--shadow-md)",marginBottom:"30px"},children:[t.jsx("div",{style:{display:"flex",gap:"12px",marginBottom:"16px"},children:t.jsxs("div",{style:{flex:1,position:"relative"},children:[t.jsx(F,{size:20,color:"var(--text-muted)",style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)"}}),t.jsx("input",{type:"text",placeholder:"Search dishes, restaurants, tags, locations...",value:s,onChange:e=>b(e.target.value),style:{width:"100%",padding:"12px 12px 12px 40px",borderRadius:"16px",border:"2px solid var(--secondary)",background:"var(--bg-cream)",fontSize:"1rem",outline:"none"}})]})}),s.trim()&&s.trim().length>=2&&t.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-muted)",marginTop:"8px",fontStyle:"italic"},children:["Found ",p.length,' results for "',s,'"']})]}),t.jsx(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.8},children:w?t.jsx("div",{style:{textAlign:"center",padding:"40px"},children:t.jsx("div",{style:{fontSize:"1.1rem",color:"var(--text-muted)"},children:"Loading spots..."})}):t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"16px"},children:p.map(e=>t.jsx(B,{spot:e,lang:v},e.id))})})]})};export{P as default};
