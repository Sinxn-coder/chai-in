import{j as e,m as g}from"./framer-BMT5hQ7X.js";import{u as z,r as c}from"./router-DOtJe_Np.js";import{u as E,s as p}from"./index-DP3Cz17j.js";import{T as P}from"./Toast-BwML1H3D.js";import{Q as R,B as S,r as I,U as C}from"./lucide-DqyMvtym.js";import{f as T}from"./utils-Ctx6mZEP.js";import"./vendor-b0vXyz-r.js";import"./supabase-CtFrdYha.js";const H=({lang:D="en"})=>{const{user:n}=E(),h=z(),[f,r]=c.useState([]),[w,a]=c.useState(!0),[x,i]=c.useState(null),_=async()=>{if(console.log("ðŸ” Starting fetchSavedPosts..."),a(!0),!n){console.log("âŒ No user found"),a(!1);return}try{console.log("ï¿½ User authenticated:",n.id);const{data:s,error:t}=await p.from("saved_posts").select("post_id").eq("user_id",n.id);if(t){console.error("âŒ Error fetching saved posts:",t),console.log("This might mean the saved_posts table doesn't exist or RLS policies are missing"),i({message:"Saved posts feature not available yet",type:"error"}),r([]),a(!1);return}if(console.log("ðŸ“Š Saved posts data:",s),!s||s.length===0){console.log("ðŸ“­ No saved posts found"),r([]),a(!1);return}const l=s.map(o=>o.post_id);console.log("ðŸŽ¯ Post IDs to fetch:",l);const{data:d,error:u}=await p.from("community_posts").select("*").in("id",l).order("created_at",{ascending:!1});if(u){console.error("âŒ Error fetching posts:",u),i({message:"Failed to load posts",type:"error"}),r([]),a(!1);return}if(console.log("ðŸ“ Posts data:",d),!d||d.length===0){console.log("ðŸ“­ No posts found for saved IDs"),r([]),a(!1);return}const m=[...new Set(d.map(o=>o.user_id))];console.log("ðŸ‘¥ User IDs to fetch:",m);const{data:y,error:v}=await p.from("user_preferences").select("user_id, username, display_name, avatar_url").in("user_id",m);v?console.error("âŒ Error fetching users:",v):console.log("ðŸ‘¤ Users data:",y);const b={};y?.forEach(o=>b[o.user_id]=o);const j=d.map(o=>({...o,author:b[o.user_id]||{display_name:"Foodie",username:null,avatar_url:null}}));console.log("âœ¨ Processed saved posts:",j),r(j)}catch(s){console.error("ðŸ’¥ Error in fetchSavedPosts:",s),i({message:"Failed to load saved posts",type:"error"}),r([])}finally{a(!1)}};c.useEffect(()=>{_()},[n]);const k=async s=>{try{await p.from("saved_posts").delete().eq("user_id",n.id).eq("post_id",s),r(f.filter(t=>t.id!==s)),i({message:"Post removed from saved",type:"success"})}catch(t){console.error("Error unsaving post:",t),i({message:"Failed to unsave post",type:"error"})}};return e.jsxs("div",{style:{minHeight:"100vh",background:"#f8f9fa",paddingBottom:"80px"},children:[x&&e.jsx(P,{message:x.message,type:x.type,onClose:()=>i(null)}),e.jsxs("div",{style:{padding:"20px",background:"#ffffff",borderBottom:"1px solid #e9ecef",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderRadius:"0 0 30px 30px",position:"relative",overflow:"hidden"},children:[e.jsx("div",{style:{position:"absolute",top:"-50px",left:"-50px",width:"150px",height:"150px",background:"linear-gradient(135deg, #007bff, #0056b3)",borderRadius:"50%",opacity:.1}}),e.jsx("div",{style:{position:"absolute",top:"-30px",right:"-30px",width:"100px",height:"100px",background:"linear-gradient(135deg, #007bff, #0056b3)",borderRadius:"50%",opacity:.1}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",position:"relative",zIndex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx(g.button,{whileTap:{scale:.95},onClick:()=>h(-1),style:{background:"rgba(0,123,255,0.1)",border:"none",padding:"10px",borderRadius:"15px",cursor:"pointer"},children:e.jsx(R,{size:20,color:"#007bff"})}),e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:"1.8rem",fontWeight:"700",color:"#1a1a1a",margin:"0 0 4px 0"},children:"Saved Posts"}),e.jsx("p",{style:{fontSize:"0.95rem",color:"#666",margin:0},children:"Your favorite food memories"})]})]}),e.jsx("div",{style:{width:"50px",height:"50px",background:"linear-gradient(135deg, #007bff, #0056b3)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 12px rgba(0,123,255,0.3)"},children:e.jsx(S,{size:24,color:"white"})})]})]}),e.jsx("div",{style:{padding:"20px"},children:w?e.jsxs("div",{style:{textAlign:"center",padding:"60px 20px"},children:[e.jsx(I,{className:"animate-spin",color:"#666",size:32}),e.jsx("p",{style:{color:"#666",marginTop:"16px",fontSize:"1rem"},children:"Loading saved posts..."})]}):f.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"80px 20px",background:"#ffffff",borderRadius:"16px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)"},children:[e.jsx("div",{style:{width:"100px",height:"100px",background:"#f8f9fa",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 24px",border:"2px solid #e9ecef"},children:e.jsx(S,{size:36,color:"#666"})}),e.jsx("h3",{style:{color:"#1a1a1a",fontWeight:"700",margin:"0 0 12px 0",fontSize:"1.3rem"},children:"No saved posts"}),e.jsx("p",{style:{color:"#666",fontSize:"1rem",lineHeight:"1.6",marginBottom:"24px"},children:"Start saving posts you love to see them here! ðŸ½ï¸"}),e.jsx(g.button,{whileTap:{scale:.95},onClick:()=>h("/community"),style:{padding:"14px 28px",borderRadius:"20px",background:"#007bff",color:"white",border:"none",fontWeight:"600",cursor:"pointer",fontSize:"1rem",boxShadow:"0 4px 12px rgba(0,123,255,0.3)"},children:"Explore Community"})]}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"20px"},children:f.map((s,t)=>e.jsxs(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.1},style:{background:"#ffffff",borderRadius:"16px",overflow:"hidden",boxShadow:"0 2px 12px rgba(0,0,0,0.08)",border:"1px solid #e9ecef"},children:[e.jsxs("div",{style:{padding:"12px",display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",background:"#f8f9fa",overflow:"hidden",flexShrink:0},children:s.author.avatar_url?e.jsx("img",{src:s.author.avatar_url,style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(C,{size:16,color:"#666"})})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:"600",fontSize:"0.85rem",color:"#1a1a1a"},children:s.author.username||s.author.display_name}),e.jsx("div",{style:{fontSize:"0.75rem",color:"#666"},children:T(new Date(s.created_at),{addSuffix:!0})})]})]}),e.jsx("div",{style:{position:"relative",width:"100%",paddingTop:"100%"},children:e.jsx("img",{src:s.image_url,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover"},onError:l=>{l.target.style.display="none"}})}),e.jsxs("div",{style:{padding:"12px"},children:[s.caption&&e.jsx("div",{style:{fontSize:"0.85rem",lineHeight:"1.4",color:"#1a1a1a",marginBottom:"8px"},children:s.caption.length>50?s.caption.substring(0,50)+"...":s.caption}),e.jsx("button",{onClick:()=>k(s.id),style:{background:"#dc3545",color:"white",border:"none",padding:"8px 16px",borderRadius:"12px",fontWeight:"600",cursor:"pointer",fontSize:"0.8rem",width:"100%"},children:"Remove from Saved"})]})]},s.id))})})]})};export{H as default};
