import{j as e,m as h}from"./framer-BMT5hQ7X.js";import{r as f,u as E,b as x}from"./router-DOtJe_Np.js";import{u as T,s as l}from"./index-Bce-E0Rq.js";import{I as L}from"./ImageSlider-CLw8UQSn.js";import{S as v,H as P}from"./lucide-DqGvG8gi.js";const J=f.memo(({spot:s})=>{const{name:y,average_rating:u,total_ratings:b,images:w,distance:S,tags:j,price_level:_,id:r,instagram_handle:$,whatsapp_number:A}=s,F=E(),{user:a}=T(),[K,k]=x.useState(!1),[d,g]=x.useState(!1),[V,z]=x.useState(0),[c,m]=x.useState(null),C=t=>({1:"₹50-150",2:"₹150-300",3:"₹300-600",4:"₹600+"})[t]||"₹50-150";f.useEffect(()=>{let t=!0;return r&&(W(t),D(t),s.opening_hours?m(I(s.opening_hours)):m(null)),()=>{t=!1}},[r,a,s.opening_hours]);const D=async t=>{if(!a)return;const{data:i}=await l.from("user_favorites").select("*").eq("spot_id",r).eq("user_id",a.id).maybeSingle();t&&g(!!i)},H=async t=>{if(t.stopPropagation(),!a)return;const i=d;g(!i);try{i?await l.from("user_favorites").delete().eq("spot_id",r).eq("user_id",a.id):await l.from("user_favorites").insert({spot_id:r,user_id:a.id})}catch{g(i)}},R=()=>new Date(new Date().toLocaleString("en-US",{timeZone:"Asia/Kolkata"})),I=t=>{if(!t||!t.open||!t.close)return null;const i=R(),[p,O=0]=t.open.split(":").map(Number),[N,B=0]=t.close.split(":").map(Number),n=new Date(i);n.setHours(p,O,0,0);const o=new Date(i);return o.setHours(N,B,0,0),o<=n&&(i<n?n.setDate(n.getDate()-1):o.setDate(o.getDate()+1)),i>=n&&i<=o},W=async t=>{try{const{count:i}=await l.from("visited_spots").select("*",{count:"exact",head:!0}).eq("spot_id",r);if(t&&z(i||0),a){const{data:p}=await l.from("visited_spots").select("user_id").eq("spot_id",r).eq("user_id",a.id).maybeSingle();t&&k(!!p)}}catch(i){console.error(i)}},q=()=>{const t=window.location.pathname.includes("/ml/")?"ml":"en";F(`/${t}/spot/${r}`)};return e.jsxs(h.div,{initial:{opacity:0,y:15},animate:{opacity:1,y:0},whileHover:{y:-5,boxShadow:"var(--shadow-hover)"},transition:{duration:.3},onClick:q,style:{background:"var(--bg-card)",borderRadius:"var(--radius-lg)",padding:"8px",boxShadow:"var(--shadow-normal)",cursor:"pointer",marginBottom:"8px",display:"flex",flexDirection:"column",gap:"6px",width:"100%",maxWidth:"100%",boxSizing:"border-box",transition:"all 0.3s ease"},children:[e.jsxs("div",{style:{position:"relative",height:"120px",borderRadius:"20px",overflow:"hidden"},onClick:t=>t.stopPropagation(),children:[e.jsx(L,{images:w,interval:4e3}),e.jsxs("div",{style:{position:"absolute",top:"6px",left:"50%",transform:"translateX(-50%)",background:c===null?"rgba(100, 116, 139, 0.7)":c?"rgba(16, 185, 129, 0.9)":"rgba(239, 68, 68, 0.9)",backdropFilter:"blur(8px)",color:"white",padding:"3px 8px",borderRadius:"16px",fontSize:"0.55rem",fontWeight:"800",display:"flex",alignItems:"center",gap:"3px"},children:[e.jsx("div",{style:{width:"4px",height:"4px",borderRadius:"50%",background:"white"}}),c===null?"HOURS N/A":c?"OPEN":"CLOSED"]}),e.jsx("div",{style:{position:"absolute",bottom:"6px",left:"6px",background:"white",padding:"2px 6px",borderRadius:"8px",display:"flex",alignItems:"center",gap:"3px",fontSize:"0.65rem",fontWeight:"800"},children:u&&b>0?e.jsxs(e.Fragment,{children:[e.jsx(v,{size:8,fill:"#FFB800",color:"#FFB800"}),e.jsx("span",{style:{marginLeft:"2px"},children:u.toFixed(1)})]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{size:8,fill:"#FFB800",color:"#FFB800"}),e.jsx("span",{children:"New"})]})})]}),e.jsxs("div",{style:{padding:"0 2px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{style:{flex:1,minWidth:0,marginRight:"8px"},children:[e.jsx("h3",{style:{fontSize:"0.85rem",fontWeight:"900",margin:"0 0 2px 0",color:"var(--text-main)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",lineHeight:"1.2"},children:y}),e.jsxs("p",{style:{fontSize:"0.7rem",color:"var(--text-muted)",margin:0,lineHeight:"1.2"},children:[S," km"]})]}),e.jsx(h.button,{whileTap:{scale:.8},onClick:H,style:{background:"none",border:"none",cursor:"pointer",padding:"2px",flexShrink:0},children:e.jsx(P,{size:18,fill:d?"var(--primary)":"none",color:d?"var(--primary)":"var(--text-muted)",style:{filter:d?"var(--icon-glow)":"none"}})})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"8px"},children:[e.jsx("div",{style:{display:"flex",gap:"4px"},children:(j||[]).slice(0,1).map((t,i)=>e.jsxs("span",{style:{fontSize:"0.65rem",color:"var(--text-highlight)",fontWeight:"700"},children:["#",t]},i))}),e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:"900",color:"var(--primary)",background:"var(--bg-light-red)",padding:"4px 8px",borderRadius:"8px"},children:C(_)})]}),e.jsx("div",{style:{marginTop:"6px",fontSize:"0.7rem",color:"var(--text-muted)",fontWeight:"700"},children:s.opening_hours?.open&&s.opening_hours?.close?`Kerala time: ${s.opening_hours.open} - ${s.opening_hours.close}`:"Hours not set"})]})]})});export{J as S};
