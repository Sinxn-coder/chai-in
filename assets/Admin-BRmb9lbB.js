import{j as e,m as L,A as se}from"./framer-BMT5hQ7X.js";import{r as c,u as ie}from"./router-DOtJe_Np.js";import{s as h}from"./index-DKYEAE00.js";import{B as U}from"./Button-D9rIKUxT.js";import{T as re}from"./Toast-BwML1H3D.js";import{U as ne,b as M,X as oe,u as q,E as ae,v as le,w as $,G as O,x as V,D as de,M as W,F as ce,y as pe,z as xe,J as ge,K as fe,O as me,j as G}from"./lucide-DqyMvtym.js";import"./vendor-b0vXyz-r.js";import"./supabase-CtFrdYha.js";const he=({showToast:p})=>{const[g,a]=c.useState([]),[u,i]=c.useState(!0),[s,n]=c.useState(null),[l,m]=c.useState({});c.useEffect(()=>{w()},[]);const w=async()=>{i(!0);try{const{data:r,error:f}=await supabase.from("spot_edit_suggestions").select(`
                    *,
                    spots:spot_id(name, location_text, category),
                    user:user_id(email, user_metadata)
                `).order("created_at",{ascending:!1});if(f)throw f;a(r||[])}catch(r){console.error("Error fetching suggestions:",r),p("Failed to load suggestions","error")}finally{i(!1)}},D=async(r,f=!1)=>{m(d=>({...d,[r]:!0}));try{const d=g.find(R=>R.id===r);if(f&&d){const{error:R}=await supabase.from("spots").update(d.suggested_data).eq("id",d.spot_id);if(R)throw R}const{error:z}=await supabase.from("spot_edit_suggestions").update({status:"approved",reviewed_by:(await supabase.auth.getUser()).data.user.id,reviewed_at:new Date().toISOString()}).eq("id",r);if(z)throw z;p(`Suggestion ${f?"approved and applied":"approved"}!`,"success"),w(),n(null)}catch(d){console.error("Error approving suggestion:",d),p("Failed to approve suggestion","error")}finally{m(d=>({...d,[r]:!1}))}},T=async(r,f="")=>{m(d=>({...d,[r]:!0}));try{const{error:d}=await supabase.from("spot_edit_suggestions").update({status:"rejected",admin_notes:f,reviewed_by:(await supabase.auth.getUser()).data.user.id,reviewed_at:new Date().toISOString()}).eq("id",r);if(d)throw d;p("Suggestion rejected","success"),w(),n(null)}catch(d){console.error("Error rejecting suggestion:",d),p("Failed to reject suggestion","error")}finally{m(d=>({...d,[r]:!1}))}},S=r=>{switch(r){case"pending":return"#f59e0b";case"approved":return"#10b981";case"rejected":return"#ef4444";default:return"#6b7280"}},k=r=>new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),B=(r,f,d)=>{const z={name:e.jsx(W,{size:14}),description:e.jsx(ce,{size:14}),location_text:e.jsx(W,{size:14}),phone:e.jsx($,{size:14}),website:e.jsx(O,{size:14}),opening_hours:e.jsx(M,{size:14}),tags:e.jsx(V,{size:14}),price_level:e.jsx(de,{size:14}),category:e.jsx(V,{size:14}),instagram_handle:e.jsx(O,{size:14}),whatsapp_number:e.jsx($,{size:14})};return e.jsxs("div",{style:{padding:"12px",background:"#f8f9fa",borderRadius:"8px",marginBottom:"8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[z[r]||e.jsx(le,{size:14}),e.jsx("strong",{style:{textTransform:"capitalize",color:"#374151"},children:r.replace(/_/g," ")})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px",fontSize:"0.85rem"},children:[e.jsxs("div",{style:{color:"#ef4444"},children:[e.jsx("span",{style:{fontWeight:"600"},children:"From:"})," ",f||"(empty)"]}),e.jsxs("div",{style:{color:"#10b981"},children:[e.jsx("span",{style:{fontWeight:"600"},children:"To:"})," ",d||"(empty)"]})]})]})};return u?e.jsx("div",{style:{padding:"20px",textAlign:"center"},children:"Loading suggestions..."}):e.jsxs("div",{style:{padding:"20px"},children:[e.jsxs("h2",{style:{fontSize:"1.5rem",fontWeight:"900",marginBottom:"20px"},children:["Edit Suggestions (",g.filter(r=>r.status==="pending").length," pending)"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px"},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"1.1rem",fontWeight:"700",marginBottom:"16px"},children:"All Suggestions"}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:g.map(r=>e.jsxs(L.div,{whileHover:{scale:1.02},onClick:()=>n(r),style:{padding:"16px",background:"white",borderRadius:"12px",border:`2px solid ${S(r.status)}`,cursor:"pointer",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"8px"},children:[e.jsxs("div",{children:[e.jsx("h4",{style:{margin:0,fontSize:"1rem",fontWeight:"800",color:"#1f2937"},children:r.spots?.name||"Unknown Spot"}),e.jsxs("p",{style:{margin:"4px 0 0 0",fontSize:"0.85rem",color:"#6b7280"},children:["by ",r.user?.user_metadata?.full_name||r.user?.email]})]}),e.jsx("div",{style:{padding:"4px 8px",borderRadius:"6px",background:S(r.status),color:"white",fontSize:"0.75rem",fontWeight:"600",textTransform:"uppercase"},children:r.status})]}),e.jsxs("div",{style:{fontSize:"0.85rem",color:"#374151",marginBottom:"8px"},children:[Object.keys(r.suggested_changes||{}).length," changes suggested"]}),e.jsx("div",{style:{fontSize:"0.75rem",color:"#9ca3af"},children:k(r.created_at)})]},r.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"1.1rem",fontWeight:"700",marginBottom:"16px"},children:"Suggestion Details"}),e.jsx(se,{children:s?e.jsxs(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},style:{padding:"20px",background:"white",borderRadius:"16px",border:"2px solid #e5e7eb",boxShadow:"0 4px 16px rgba(0,0,0,0.1)"},children:[e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("h4",{style:{margin:"0 0 8px 0",fontSize:"1.1rem",fontWeight:"800",color:"#1f2937"},children:s.spots?.name||"Unknown Spot"}),e.jsxs("div",{style:{display:"flex",gap:"16px",fontSize:"0.85rem",color:"#6b7280"},children:[e.jsxs("span",{children:[e.jsx(ne,{size:14,style:{display:"inline",marginRight:"4px"}}),s.user?.user_metadata?.full_name||s.user?.email]}),e.jsxs("span",{children:[e.jsx(M,{size:14,style:{display:"inline",marginRight:"4px"}}),k(s.created_at)]})]})]}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsxs("h5",{style:{margin:"0 0 12px 0",fontSize:"0.95rem",fontWeight:"700",color:"#374151"},children:["Proposed Changes (",Object.keys(s.suggested_changes||{}).length,")"]}),Object.entries(s.suggested_changes||{}).map(([r,{old:f,new:d}])=>B(r,f,d))]}),s.status==="pending"&&e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[e.jsxs("button",{onClick:()=>T(s.id),disabled:l[s.id],style:{padding:"10px 16px",border:"none",background:"#ef4444",color:"white",borderRadius:"8px",fontWeight:"600",cursor:l[s.id]?"not-allowed":"pointer",opacity:l[s.id]?.6:1,display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(oe,{size:16}),l[s.id]?"Processing...":"Reject"]}),e.jsxs("button",{onClick:()=>D(s.id,!1),disabled:l[s.id],style:{padding:"10px 16px",border:"none",background:"#3b82f6",color:"white",borderRadius:"8px",fontWeight:"600",cursor:l[s.id]?"not-allowed":"pointer",opacity:l[s.id]?.6:1,display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(q,{size:16}),l[s.id]?"Processing...":"Approve"]}),e.jsxs("button",{onClick:()=>D(s.id,!0),disabled:l[s.id],style:{padding:"10px 16px",border:"none",background:"#10b981",color:"white",borderRadius:"8px",fontWeight:"600",cursor:l[s.id]?"not-allowed":"pointer",opacity:l[s.id]?.6:1,display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(q,{size:16}),l[s.id]?"Processing...":"Apply & Approve"]})]}),s.status!=="pending"&&e.jsxs("div",{style:{padding:"12px",background:s.status==="approved"?"#f0fdf4":"#fef2f2",borderRadius:"8px",border:`1px solid ${s.status==="approved"?"#86efac":"#fca5a5"}`},children:[e.jsx("p",{style:{margin:0,fontSize:"0.85rem",fontWeight:"600",color:s.status==="approved"?"#166534":"#991b1b"},children:s.status==="approved"?"✅ Approved":"❌ Rejected"}),s.admin_notes&&e.jsxs("p",{style:{margin:"8px 0 0 0",fontSize:"0.8rem",color:"#6b7280"},children:["Notes: ",s.admin_notes]}),s.reviewed_at&&e.jsxs("p",{style:{margin:"8px 0 0 0",fontSize:"0.75rem",color:"#9ca3af"},children:["Reviewed: ",k(s.reviewed_at)]})]})]}):e.jsxs("div",{style:{padding:"40px",textAlign:"center",color:"#9ca3af",background:"#f9fafb",borderRadius:"12px",border:"2px dashed #e5e7eb"},children:[e.jsx(ae,{size:48,style:{marginBottom:"16px",opacity:.5}}),e.jsx("p",{children:"Select a suggestion to view details"})]})})]})]})]})},Ae=()=>{const[p,g]=c.useState([]),[a,u]=c.useState(!0),[i,s]=c.useState(null),[n,l]=c.useState("analytics"),[m,w]=c.useState(!1);ie();const[D,T]=c.useState([]),[S,k]=c.useState({title:"",message:""}),[B,r]=c.useState(!1),[f,d]=c.useState({totalUsers:0,totalSpots:0,signupsByMonth:[],topContributors:[],activeAreas:[]}),[z,R]=c.useState(30),[N,H]=c.useState("");c.useEffect(()=>{if(!m)return;u(!0),P(),I(),Z();const t=h.channel("spots_changes").on("postgres_changes",{event:"*",schema:"public",table:"spots"},x=>{x.eventType==="UPDATE"?g(v=>v.map(b=>b.id===x.new.id?{...b,...x.new}:b)):x.eventType==="DELETE"?g(v=>v.filter(b=>b.id!==x.old.id)):x.eventType==="INSERT"&&g(v=>[...v,x.new])}).subscribe(),o=()=>{const x=window.location.hash.replace("#","");["analytics","spots","community","reviews","notifications","moderation"].includes(x)&&l(x)};return o(),window.addEventListener("hashchange",o),()=>{window.removeEventListener("hashchange",o),t.unsubscribe()}},[z,m]);const y=(t,o="success")=>{s({message:t,type:o})},P=async()=>{const{data:t,error:o}=await h.from("spots").select("*").order("created_at",{ascending:!1});t&&g(t),o&&y("Failed to fetch spots","error"),u(!1)},X=async t=>{if(!confirm("Permanently delete this spot?"))return;const{error:o}=await h.from("spots").delete().eq("id",t);o?(console.error(o),y("Failed to delete: "+o.message,"error")):(y("Spot deleted","success"),g(p.filter(x=>x.id!==t)))},K=async(t,o)=>{try{console.log("Toggling verification for spot:",t,"current status:",o);const{data:x,error:v}=await h.from("spots").select("*").eq("id",t).single();if(v){console.error("Error fetching current spot:",v),y("Failed to fetch spot data: "+v.message,"error");return}console.log("Current spot data:",x);const b=!o,{data:E,error:_}=await h.from("spots").update({is_verified:b}).eq("id",t).select();if(_){console.error("Verification error:",_),console.error("Error details:",{message:_.message,details:_.details,hint:_.hint,code:_.code}),_.code==="42501"||_.message.includes("permission")?y("Permission denied. Check RLS policies in Supabase.","error"):y("Failed to update: "+_.message,"error");return}console.log("Verification successful, updated data:",E),g(p.map(A=>A.id===t?{...A,is_verified:b}:A)),y(`Spot ${b?"verified":"unverified"} successfully`,"success"),window.dispatchEvent(new CustomEvent("spotVerified",{detail:{spotId:t,isVerified:b}})),setTimeout(()=>{console.log("Re-fetching spots to ensure persistence..."),P()},1e3)}catch(x){console.error("Toggle verification error:",x),y("Failed to update: "+x.message,"error")}},I=async()=>{const{data:t,error:o}=await h.from("notifications").select("*").order("created_at",{ascending:!1});t&&T(t)},J=async()=>{if(!S.title||!S.message)return;r(!0);const{error:t}=await h.from("notifications").insert([{title:S.title,message:S.message,is_active:!0}]);t?y("Failed to send","error"):(y("Notification Sent!","success"),k({title:"",message:""}),I()),r(!1)},Q=async t=>{const{error:o}=await h.from("notifications").delete().eq("id",t);o||(T(D.filter(x=>x.id!==t)),y("Notification deleted"))},Y=async(t,o)=>{await h.from("notifications").update({is_active:!o}).eq("id",t),I()},Z=async()=>{try{const{data:t}=await h.from("user_preferences").select("created_at, display_name, username, user_id"),{data:o}=await h.from("spots").select("created_by, location_text, created_at");if(!t||!o)return;const x=new Date,v=new Date;v.setDate(x.getDate()-z);const b=t.filter(j=>new Date(j.created_at)>=v),E={};b.forEach(j=>{const C=new Date(j.created_at).toLocaleDateString("default",{month:"short",day:"numeric"});E[C]=(E[C]||0)+1});const _=Object.entries(E).map(([j,C])=>({name:j,count:C})),A={};o.forEach(j=>{j.created_by&&(A[j.created_by]=(A[j.created_by]||0)+1)});const ee=Object.entries(A).map(([j,C])=>{const F=t.find(te=>te.user_id===j);return{name:F?.username||F?.display_name||"Anonymous",count:C}}).sort((j,C)=>C.count-j.count).slice(0,5);d({totalUsers:t.length,totalSpots:o.length,signupsByMonth:_,topContributors:ee,activeAreas:[]})}catch(t){console.error(t)}finally{u(!1)}};return m?e.jsxs("div",{style:{padding:"20px 20px 100px 20px",maxWidth:"1200px",margin:"0 auto"},children:[i&&e.jsx(re,{message:i.message,type:i.type,onClose:()=>s(null)}),e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:e.jsx("h1",{style:{fontSize:"1.8rem"},children:"Admin Dashboard"})}),e.jsx("div",{style:{display:"flex",gap:"8px",overflowX:"auto",paddingBottom:"10px",marginBottom:"20px"},className:"hide-scrollbar",children:["analytics","spots","community","reviews","notifications","moderation"].map(t=>e.jsx("button",{onClick:()=>l(t),style:{padding:"10px 20px",borderRadius:"30px",border:"none",background:n===t?"var(--primary)":"white",color:n===t?"white":"#555",fontWeight:"700",textTransform:"capitalize",whiteSpace:"nowrap",boxShadow:n===t?"0 4px 12px rgba(226, 55, 68, 0.3)":"0 2px 8px rgba(0,0,0,0.05)"},children:t},t))}),a&&e.jsx("p",{children:"Loading data..."}),!a&&n==="analytics"&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"20px"},children:[e.jsxs("div",{className:"glass-card",style:{padding:"20px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("p",{style:{color:"#888",margin:0},children:"Total Users"}),e.jsx("h2",{style:{fontSize:"2.5rem",margin:0},children:f.totalUsers})]}),e.jsx(xe,{size:40,color:"var(--primary)"})]}),e.jsxs("div",{className:"glass-card",style:{padding:"20px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("p",{style:{color:"#888",margin:0},children:"Total Spots"}),e.jsx("h2",{style:{fontSize:"2.5rem",margin:0},children:f.totalSpots})]}),e.jsx(W,{size:40,color:"orange"})]}),e.jsxs("div",{className:"glass-card",style:{padding:"20px",gridColumn:"1 / -1"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[e.jsx("h3",{style:{margin:0},children:"Growth Analytics"}),e.jsx("div",{style:{display:"flex",gap:"8px"},children:[30,60,90].map(t=>e.jsxs("button",{onClick:()=>R(t),style:{padding:"6px 12px",borderRadius:"8px",border:"1px solid #ddd",background:z===t?"var(--primary)":"white",color:z===t?"white":"#666",fontSize:"0.8rem",fontWeight:"700",cursor:"pointer"},children:[t," Days"]},t))})]}),e.jsx("div",{style:{width:"100%",height:"250px",position:"relative"},children:f.signupsByMonth.length>0&&e.jsx(je,{data:f.signupsByMonth})}),e.jsx("p",{style:{textAlign:"center",fontSize:"0.8rem",color:"#888",marginTop:"1rem"},children:"User Signups over time"})]}),e.jsxs("div",{className:"glass-card",style:{padding:"20px"},children:[e.jsx("h3",{children:"Top Contributors"}),f.topContributors.map((t,o)=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"10px 0",borderBottom:"1px solid #eee"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("span",{style:{fontWeight:"bold",width:"20px"},children:o+1}),e.jsx("span",{children:t.name})]}),e.jsx("span",{style:{fontWeight:"bold",color:"var(--primary)"},children:t.count})]},o))]})]}),!a&&n==="spots"&&e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:p.map(t=>e.jsxs("div",{className:"glass-card",style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1rem"},children:[e.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"center"},children:[e.jsx("img",{src:t.images?.[0]||"https://via.placeholder.com/100",style:{width:"60px",height:"60px",borderRadius:"8px",objectFit:"cover"}}),e.jsxs("div",{children:[e.jsx("h4",{style:{margin:0,fontWeight:"700"},children:t.name}),e.jsx("p",{style:{margin:0,fontSize:"0.85rem",color:"#666"},children:t.location_text}),t.is_verified&&e.jsx("span",{style:{fontSize:"0.7rem",color:"green",fontWeight:"bold"},children:"Verified"})]})]}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("button",{onClick:()=>K(t.id,t.is_verified),style:{padding:"8px",background:"#e8f5e9",color:"#2e7d32",borderRadius:"8px",border:"none"},children:e.jsx(ge,{size:18})}),e.jsx("button",{onClick:()=>X(t.id),style:{padding:"8px",background:"#ffebee",color:"#c62828",borderRadius:"8px",border:"none"},children:e.jsx(fe,{size:18})})]})]},t.id))}),!a&&n==="notifications"&&e.jsxs("div",{children:[e.jsxs("div",{className:"glass-card",style:{padding:"20px",marginBottom:"20px"},children:[e.jsx("h3",{children:"Create Notification"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[e.jsx("input",{type:"text",placeholder:"Notification Title",value:S.title,onChange:t=>k({...S,title:t.target.value}),style:{padding:"10px",borderRadius:"8px",border:"1px solid #ddd"}}),e.jsx("textarea",{placeholder:"Message Body",value:S.message,onChange:t=>k({...S,message:t.target.value}),style:{padding:"10px",borderRadius:"8px",border:"1px solid #ddd",minHeight:"80px"}}),e.jsxs(U,{onClick:J,disabled:B,children:[B?"Sending...":"Send to All Users"," ",e.jsx(me,{size:16,style:{marginLeft:"8px"}})]})]})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:D.map(t=>e.jsxs("div",{className:"glass-card",style:{padding:"15px",position:"relative"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[e.jsx("h4",{style:{margin:0},children:t.title}),e.jsx("span",{style:{fontSize:"0.8rem",color:t.is_active?"green":"red",fontWeight:"bold"},children:t.is_active?"ACTIVE":"INACTIVE"})]}),e.jsx("p",{style:{margin:0,color:"#555"},children:t.message}),e.jsxs("div",{style:{marginTop:"10px",display:"flex",gap:"10px"},children:[e.jsx("button",{onClick:()=>Y(t.id,t.is_active),style:{fontSize:"0.8rem",padding:"4px 8px"},children:"Toggle Active"}),e.jsx("button",{onClick:()=>Q(t.id),style:{fontSize:"0.8rem",padding:"4px 8px",color:"red"},children:"Delete"})]})]},t.id))})]}),!a&&n==="community"&&e.jsx(ue,{}),!a&&n==="reviews"&&e.jsx(ye,{}),!a&&n==="moderation"&&e.jsx(he,{showToast:y})]}):e.jsx("div",{style:{height:"80vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"20px"},children:e.jsxs("div",{className:"glass-card",style:{padding:"30px",width:"100%",maxWidth:"400px",textAlign:"center"},children:[e.jsx(pe,{size:48,color:"var(--primary)",style:{marginBottom:"20px"}}),e.jsx("h2",{style:{marginBottom:"10px"},children:"Admin Login"}),e.jsx("p",{style:{color:"#666",marginBottom:"20px"},children:"Please enter your PIN to access the dashboard."}),e.jsx("input",{type:"password",id:"adminPinInput",placeholder:"Enter PIN",value:N,onChange:t=>H(t.target.value),style:{width:"100%",padding:"12px",borderRadius:"12px",border:"1px solid #ddd",marginBottom:"20px",textAlign:"center",fontSize:"1.2rem",letterSpacing:"4px"},onKeyDown:t=>{t.key==="Enter"&&N==="Sinu@12345"?w(!0):t.key==="Enter"&&y("Incorrect PIN","error")}}),e.jsx(U,{onClick:()=>{N==="Sinu@12345"?w(!0):y("Incorrect PIN","error")},style:{width:"100%"},children:"Access Dashboard"})]})})},ue=()=>{const[p,g]=c.useState([]),[a,u]=c.useState(!0);c.useEffect(()=>{i()},[]);const i=async()=>{const{data:n}=await h.from("community_posts").select("*").order("created_at",{ascending:!1});g(n||[]),u(!1)},s=async n=>{if(!confirm("Delete this post?"))return;const{error:l}=await h.from("community_posts").delete().eq("id",n);l?(console.error(l),alert("Failed to delete post: "+l.message)):g(p.filter(m=>m.id!==n))};return a?e.jsx("div",{children:"Loading..."}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(180px, 1fr))",gap:"15px"},children:p.map(n=>e.jsxs("div",{className:"glass-card",style:{padding:"10px",overflow:"hidden"},children:[e.jsx("img",{src:n.image_url,style:{width:"100%",height:"120px",objectFit:"cover",borderRadius:"8px"}}),e.jsx("p",{style:{fontSize:"0.8rem",margin:"8px 0",height:"40px",overflow:"hidden"},children:n.caption}),e.jsxs("button",{onClick:()=>s(n.id),style:{width:"100%",padding:"6px",background:"#ffebee",color:"red",border:"none",borderRadius:"6px",cursor:"pointer"},children:[e.jsx(G,{size:16})," Delete"]})]},n.id))})},ye=()=>{const[p,g]=c.useState([]);c.useEffect(()=>{a()},[]);const a=async()=>{const{data:i}=await h.from("reviews").select("*").order("created_at",{ascending:!1}).limit(50);g(i||[])},u=async i=>{if(!confirm("Delete review?"))return;const{error:s}=await h.from("reviews").delete().eq("id",i);s?(console.error(s),alert("Failed to delete review: "+s.message)):g(p.filter(n=>n.id!==i))};return e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:p.map(i=>e.jsxs("div",{className:"glass-card",style:{padding:"15px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{display:"flex",gap:"4px"},children:[...Array(i.rating)].map((s,n)=>e.jsx("span",{children:"⭐"},n))}),e.jsx("p",{style:{marginTop:"5px",marginBottom:"0",fontSize:"0.9rem"},children:i.comment})]}),e.jsx("button",{onClick:()=>u(i.id),style:{background:"#ffebee",border:"none",cursor:"pointer",padding:"8px",borderRadius:"8px",color:"red"},children:e.jsx(G,{size:18})})]},i.id))})},je=({data:p})=>{const g=Math.max(...p.map(n=>n.count),5),a=200,u=800,i=30,s=p.map((n,l)=>{const m=i+l*(u-i*2)/(p.length-1||1),w=a-i-n.count*(a-i*2)/g;return`${m},${w}`}).join(" ");return e.jsxs("svg",{viewBox:`0 0 ${u} ${a}`,style:{width:"100%",height:"100%"},children:[e.jsx("line",{x1:i,y1:a-i,x2:u-i,y2:a-i,stroke:"#eee"}),e.jsx("line",{x1:i,y1:i,x2:i,y2:a-i,stroke:"#eee"}),e.jsx("text",{x:i-10,y:i,textAnchor:"end",fontSize:"10",fill:"#999",children:g}),e.jsx("text",{x:i-10,y:a-i,textAnchor:"end",fontSize:"10",fill:"#999",children:"0"}),e.jsx("polyline",{fill:"none",stroke:"var(--primary)",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",points:s}),p.map((n,l)=>{const m=i+l*(u-i*2)/(p.length-1||1),w=a-i-n.count*(a-i*2)/g;return e.jsxs("g",{children:[e.jsx("circle",{cx:m,cy:w,r:"4",fill:"white",stroke:"var(--primary)",strokeWidth:"2"}),e.jsx("text",{x:m,y:a-5,textAnchor:"middle",fontSize:"10",fill:"#999",children:n.name}),e.jsx("text",{x:m,y:w-10,textAnchor:"middle",fontSize:"12",fontWeight:"700",fill:"var(--primary)",children:n.count})]},l)})]})};export{Ae as default};
