import{j as e,m as r}from"./framer-BMT5hQ7X.js";import{u as V,r as s}from"./router-DOtJe_Np.js";import{u as D,s as n}from"./index-BW6a0xE2.js";import{S as T}from"./SpotCard-3GiriIwI.js";import{a as I,M as N,X as U,T as $,b as G}from"./lucide-DBAHIzol.js";import"./vendor-b0vXyz-r.js";import"./supabase-CtFrdYha.js";import"./ImageSlider-BBQkwHeU.js";const oe=({lang:k})=>{const C=V(),{user:W}=D(),[x,E]=s.useState([]),[O,u]=s.useState(!0),[l,f]=s.useState(""),[c,v]=s.useState(null),[B,y]=s.useState("All Kerala"),[P,b]=s.useState(!1),[p,S]=s.useState(""),[d,j]=s.useState(!1),[w,R]=s.useState([]),[z,q]=s.useState([]);s.useEffect(()=>{m(),h(),g();const t=n.channel("home_spots_changes").on("postgres_changes",{event:"UPDATE",schema:"public",table:"spots",filter:"is_verified=eq.true"},i=>{console.log("Home page received real-time update:",i),i.new.is_verified&&(m(),h(),g())}).subscribe(),a=n.channel("home_ratings_changes").on("postgres_changes",{event:"*",schema:"public",table:"spot_ratings"},i=>{console.log("Home page received rating change:",i),m(),h(),g()}).subscribe(),o=i=>{console.log("Home page received custom verification event:",i.detail),m()};return window.addEventListener("spotVerified",o),()=>{t.unsubscribe(),a.unsubscribe(),window.removeEventListener("spotVerified",o)}},[c]);const h=async()=>{const t=new Date(Date.now()-6048e5),{data:a}=await n.from("spots").select("*, reviews(count)").eq("is_verified",!0).gte("created_at",t.toISOString()).order("reviews.count",{ascending:!1}).limit(5);R(a||[])},g=async()=>{const{data:t}=await n.from("spots").select("*").eq("is_verified",!0).order("created_at",{ascending:!1}).limit(5);q(t||[])},m=async()=>{u(!0),console.log("Fetching spots from database...");const{data:t,error:a}=await n.from("spots").select("*").eq("is_verified",!0).order("created_at",{ascending:!1});if(a)console.error("Error fetching spots:",a);else{console.log("Fetched spots:",t);let o=t||[];c&&(o=o.filter(i=>A(c.lat,c.lng,i.latitude,i.longitude)<=30)),console.log("Setting spots state:",o),E(o)}u(!1)};s.useMemo(()=>x.filter(t=>{const a=l.toLowerCase();return a.replace(/\s+/g,""),a.replace(/\s+/g,"-"),!l||t.name.toLowerCase().includes(a)||t.location?.toLowerCase().includes(a)}),[x,l]);function A(t,a,o,i){var K=6371,_=(o-t)*Math.PI/180,F=(i-a)*Math.PI/180,M=Math.sin(_/2)*Math.sin(_/2)+Math.cos(t*Math.PI/180)*Math.cos(o*Math.PI/180)*Math.sin(F/2);return K*(2*Math.atan2(Math.sqrt(M),Math.sqrt(1-M)))}const L=async()=>{if(p.trim()){j(!0);try{const a=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(p+", Kerala, India")}&limit=1`)).json();if(a&&a.length>0){const o={lat:parseFloat(a[0].lat),lng:parseFloat(a[0].lon),name:a[0].display_name.split(",")[0]};v(o),y(o.name),b(!1)}}catch(t){console.error("Error searching location:",t)}finally{j(!1)}}},H=()=>{v(null),y("All Kerala"),S("")};return e.jsx("div",{style:{paddingBottom:"100px",background:"var(--bg-main)",minHeight:"100vh"},children:e.jsxs("div",{className:"container",style:{padding:"0 16px",maxWidth:"100%",boxSizing:"border-box"},children:[e.jsxs("header",{style:{marginBottom:"24px"},children:[e.jsxs("p",{style:{margin:0,fontSize:"1rem",color:"var(--text-muted)"},children:["Hello ",W?.user_metadata?.full_name?.split(" ")[0]||"Foodie",","]}),e.jsx("h1",{style:{margin:"4px 0",fontSize:"1.6rem",fontWeight:"900",color:"var(--text-main)"},children:"What do you want to eat today?"})]}),e.jsxs("div",{style:{position:"relative",marginBottom:"24px"},children:[e.jsx("input",{type:"text",placeholder:"Search dishes, restaurants...",value:l,onChange:t=>{const a=t.target.value;a==="#admin"?(C(`/${k}/admin`),f("")):f(a)},style:{width:"100%",padding:"16px 20px 16px 50px",borderRadius:"var(--radius-lg)",border:"none",background:"var(--secondary)",fontSize:"1rem",fontWeight:"600"}}),e.jsx(I,{size:22,color:"var(--text-muted)",style:{position:"absolute",left:"16px",top:"50%",transform:"translateY(-50%)"}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"20px"},children:[e.jsxs(r.button,{whileTap:{scale:.95},onClick:()=>b(!P),style:{background:"rgba(239, 42, 57, 0.1)",color:"var(--primary)",padding:"8px 16px",borderRadius:"12px",fontSize:"0.85rem",fontWeight:"800",display:"flex",alignItems:"center",gap:"6px",border:"none",cursor:"pointer",transition:"all 0.3s ease",flexShrink:0},children:[e.jsx(N,{size:16})," ",B]}),e.jsx("div",{style:{flex:1,minWidth:"200px"},children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:"text",placeholder:"Search location in Kerala...",value:p,onChange:t=>S(t.target.value),onKeyPress:t=>t.key==="Enter"&&L(),style:{width:"100%",padding:"0 70px 0 45px",borderRadius:"25px",border:"2px solid var(--primary)",background:"var(--bg-white)",fontSize:"0.85rem",fontWeight:"600",boxShadow:"0 4px 15px rgba(239, 42, 57, 0.15)",transition:"all 0.3s ease",boxSizing:"border-box",lineHeight:"44px"}}),e.jsx(I,{size:20,color:"var(--primary)",style:{position:"absolute",left:"15px",top:"12px",zIndex:2}}),e.jsx(r.button,{whileTap:{scale:.95},onClick:L,disabled:d,style:{position:"absolute",right:"8px",top:"7px",background:"var(--primary)",color:"white",border:"none",padding:"8px 16px",borderRadius:"20px",fontSize:"0.75rem",fontWeight:"700",cursor:d?"not-allowed":"pointer",opacity:d?.6:1,boxShadow:"0 2px 8px rgba(239, 42, 57, 0.3)",zIndex:2,height:"30px"},children:d?"...":"Go"}),p&&e.jsx(r.button,{whileTap:{scale:.95},onClick:H,style:{position:"absolute",right:"70px",top:"7px",background:"transparent",color:"#6b7280",border:"none",padding:"8px",borderRadius:"20px",fontSize:"0.75rem",fontWeight:"700",cursor:"pointer",zIndex:2,height:"30px"},children:e.jsx(U,{size:16})})]})})]}),w.length>0&&e.jsxs(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},style:{marginBottom:"30px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[e.jsx($,{size:24,color:"var(--primary)"}),e.jsx("h3",{style:{fontSize:"1.3rem",fontWeight:"800",color:"var(--text-main)"},children:"Trending This Week"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"16px"},children:w.map(t=>e.jsx(T,{spot:t},t.id))})]}),z.length>0&&e.jsxs(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.6},style:{marginBottom:"30px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[e.jsx(G,{size:24,color:"var(--primary)"}),e.jsx("h3",{style:{fontSize:"1.3rem",fontWeight:"800",color:"var(--text-main)"},children:"Popular Spots"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"16px"},children:z.map(t=>e.jsx(T,{spot:t},t.id))})]})]})})};export{oe as default};
