import{j as e,m as w}from"./framer-BMT5hQ7X.js";import{u as K,r as s}from"./router-DOtJe_Np.js";import{s as j}from"./index-CxxIpOSZ.js";import{S as N}from"./SpotCard-BTykcIVj.js";import{T as P}from"./Toast-BwML1H3D.js";import{a as V}from"./lucide-DqyMvtym.js";import"./vendor-b0vXyz-r.js";import"./supabase-CtFrdYha.js";import"./ImageSlider-D9DlSLMK.js";const ht=({lang:b})=>{K();const[m,F]=s.useState([]),[z,M]=s.useState(!0),[x,E]=s.useState(""),[O,$]=s.useState([]),[U,A]=s.useState([]),[y,C]=s.useState(null),[Y,G]=s.useState(null),[J,Q]=s.useState("All Kerala"),[X,Z]=s.useState(!1),[tt,et]=s.useState(""),[D,T]=s.useState(!1),[i,S]=s.useState(null),[v,I]=s.useState({}),[a,W]=s.useState("");s.useEffect(()=>{const t=setTimeout(()=>{W(x)},300);return()=>clearTimeout(t)},[x]),s.useEffect(()=>{_(),q(),R()},[]),s.useEffect(()=>{(async()=>{if(a.trim()&&a.trim().length>=2){if(v[a.toLowerCase()]){S(v[a.toLowerCase()]);return}T(!0);const r=await B(a);S(r),r&&I(o=>({...o,[a.toLowerCase()]:r})),T(!1)}else S(null)})()},[a,v]);const _=async()=>{M(!0);const{data:t,error:r}=await j.from("spots").select("*").eq("is_verified",!0).order("created_at",{ascending:!1});r?(console.error("Error fetching spots:",r),C({message:"Failed to load spots",type:"error"})):F(t||[]),M(!1)},q=async()=>{const t=new Date(Date.now()-6048e5),{data:r}=await j.from("spots").select("*").eq("is_verified",!0).gte("created_at",t.toISOString()).order("created_at",{ascending:!1}).limit(5);$(r||[])},R=async()=>{const{data:t}=await j.from("spots").select("*").eq("is_verified",!0).order("created_at",{ascending:!1}).limit(5);A(t||[])};function k(t,r,o,h){var L=6371,l=(o-t)*Math.PI/180,d=(h-r)*Math.PI/180,n=Math.sin(l/2)*Math.sin(l/2)+Math.cos(t*Math.PI/180)*Math.cos(o*Math.PI/180)*Math.sin(d/2)*Math.sin(d/2),p=2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n)),u=L*p;return u}const B=async t=>{try{const o=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(t+", Kerala, India")}&limit=1`)).json();if(o&&o.length>0)return{lat:parseFloat(o[0].lat),lng:parseFloat(o[0].lon)}}catch(r){console.error("Error getting location coordinates:",r)}return null},c=s.useMemo(()=>{if(!a.trim()||a.trim().length<2)return m;const t=a.toLowerCase().trim();return i?m.filter(o=>k(o.latitude,o.longitude,i.lat,i.lng)<=30):m.filter(o=>{const h=o.name&&o.name.toLowerCase().includes(t),L=o.location&&o.location.toLowerCase().includes(t);let l=!1;return o.tags&&Array.isArray(o.tags)&&o.tags.length>0&&(l=o.tags.some(d=>{if(!d)return!1;const n=d.toLowerCase(),p=n.replace(/\s+/g,""),u=n.replace(/\s+/g,"-"),H=n.replace(/-/g,""),g=t.replace(/\s+/g,""),f=t.replace(/\s+/g,"-");return t.length>=2&&n.includes(t)||g.length>=2&&p.includes(g)||f.length>=2&&u.includes(f)||t.length>=2&&H.includes(t)||t.length>=2&&t.includes(n)||g.length>=2&&g.includes(p)||f.length>=2&&f.includes(u)})),h||L||l})},[m,a,i]);return e.jsxs("div",{style:{minHeight:"100vh",background:"var(--bg-cream)",padding:"20px"},children:[y&&e.jsx(P,{message:y.message,type:y.type,onClose:()=>C(null)}),e.jsx(w.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},style:{textAlign:"center",marginBottom:"30px"},children:a.trim()?e.jsxs(e.Fragment,{children:[e.jsx("h1",{style:{fontSize:"2rem",fontWeight:"900",color:"var(--primary)",marginBottom:"10px"},children:i?"Nearby Spots":"Search Results"}),e.jsx("p",{style:{color:"var(--text-muted)",fontSize:"1rem"},children:i?`Showing ${c.length} spots within 30km of "${a}"`:`Showing ${c.length} spots for "${a}"`})]}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{style:{fontSize:"2rem",fontWeight:"900",color:"var(--primary)",marginBottom:"10px"},children:"Explore All Spots"}),e.jsx("p",{style:{color:"var(--text-muted)",fontSize:"1rem"},children:"Discover amazing food spots across Kerala"})]})}),e.jsxs(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},style:{background:"white",padding:"20px",borderRadius:"20px",boxShadow:"var(--shadow-md)",marginBottom:"30px"},children:[e.jsx("div",{style:{display:"flex",gap:"12px",marginBottom:"16px"},children:e.jsxs("div",{style:{flex:1,position:"relative"},children:[e.jsx(V,{size:20,color:"var(--text-muted)",style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)"}}),e.jsx("input",{type:"text",placeholder:"Search dishes, restaurants, tags, locations...",value:x,onChange:t=>E(t.target.value),style:{width:"100%",padding:"12px 12px 12px 40px",borderRadius:"16px",border:"2px solid var(--secondary)",background:"var(--bg-cream)",fontSize:"1rem",outline:"none"}})]})}),a.trim()&&a.trim().length>=2&&e.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-muted)",marginTop:"8px",fontStyle:"italic"},children:D?"Detecting location...":i?`Found ${c.length} spots within 30km of "${a}"`:`Found ${c.length} results for "${a}"`})]}),e.jsx(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.8},children:z?e.jsx("div",{style:{textAlign:"center",padding:"40px"},children:e.jsx("div",{style:{fontSize:"1.1rem",color:"var(--text-muted)"},children:"Loading spots..."})}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"16px"},children:c.map(t=>e.jsx(N,{spot:t,lang:b},t.id))})})]})};export{ht as default};
