import{j as a,m as C}from"./framer-BMT5hQ7X.js";import{u as J,r as s}from"./router-DOtJe_Np.js";import{s as T}from"./index-DB8Anl3c.js";import{S as Q}from"./SpotCard-CJcr1ELr.js";import{S as X}from"./SkeletonLoader-D7onCYtA.js";import{T as Z}from"./Toast-BwML1H3D.js";import{a as tt,M as et}from"./lucide-DqyMvtym.js";import"./vendor-b0vXyz-r.js";import"./supabase-CtFrdYha.js";import"./ImageSlider-D9DlSLMK.js";const jt=({lang:D})=>{J();const[g,E]=s.useState([]),[_,u]=s.useState(!0),[r,F]=s.useState(""),[ot,$]=s.useState([]),[at,A]=s.useState([]),[w,I]=s.useState(null),[st,nt]=s.useState(null),[rt,it]=s.useState("All Kerala"),[ct,lt]=s.useState(!1),[dt,pt]=s.useState(""),[B,k]=s.useState(!1),[l,f]=s.useState(null),[L,z]=s.useState({}),[n,R]=s.useState(""),[j,b]=s.useState([]),[W,d]=s.useState(!1);s.useEffect(()=>{const t=setTimeout(()=>{R(r)},300);return()=>clearTimeout(t)},[r]),s.useEffect(()=>{(async()=>{u(!0);try{await Promise.all([P(),q(),H()])}finally{u(!1)}})()},[]),s.useEffect(()=>{(async()=>{if(r.trim()&&r.trim().length>=2){const o=await N(r);b(o),d(o.length>0)}else b([]),d(!1)})()},[r]),s.useEffect(()=>{(async()=>{if(n.trim()&&n.trim().length>=2){if(L[n.toLowerCase()]){f(L[n.toLowerCase()]);return}k(!0);const o=await V(n);f(o),o&&z(e=>({...e,[n.toLowerCase()]:o})),k(!1)}else f(null)})()},[n,L]);const P=async()=>{u(!0);const{data:t,error:o}=await T.from("spots").select("*").eq("is_verified",!0).order("created_at",{ascending:!1});o?(console.error("Error fetching spots:",o),I({message:"Failed to load spots",type:"error"})):E(t||[]),u(!1)},q=async()=>{const t=new Date(Date.now()-6048e5),{data:o}=await T.from("spots").select("*").eq("is_verified",!0).gte("created_at",t.toISOString()).order("created_at",{ascending:!1}).limit(5);$(o||[])},H=async()=>{const{data:t}=await T.from("spots").select("*").eq("is_verified",!0).order("created_at",{ascending:!1}).limit(5);A(t||[])};function K(t,o,e,i){var M=6371,m=(e-t)*Math.PI/180,h=(i-o)*Math.PI/180,c=Math.sin(m/2)*Math.sin(m/2)+Math.cos(t*Math.PI/180)*Math.cos(e*Math.PI/180)*Math.sin(h/2)*Math.sin(h/2),x=2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),y=M*x;return y}const N=async t=>{if(!t||t.length<2)return[];try{const e=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(t+", Kerala, India")}&limit=5&addressdetails=1`)).json();if(e&&e.length>0)return e.map(i=>({display_name:i.display_name,lat:parseFloat(i.lat),lng:parseFloat(i.lon),name:i.display_name.split(",")[0].trim()}))}catch(o){console.error("Error getting location suggestions:",o)}return[]},V=async t=>{try{const e=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(t+", Kerala, India")}&limit=1`)).json();if(e&&e.length>0)return{lat:parseFloat(e[0].lat),lng:parseFloat(e[0].lon)}}catch(o){console.error("Error getting location coordinates:",o)}return null},p=s.useMemo(()=>{if(!n.trim()||n.trim().length<2)return g;const t=n.toLowerCase().trim();return l?g.filter(e=>K(e.latitude,e.longitude,l.lat,l.lng)<=30):g.filter(e=>{const i=e.name&&e.name.toLowerCase().includes(t),M=e.location&&e.location.toLowerCase().includes(t);let m=!1;return e.tags&&Array.isArray(e.tags)&&e.tags.length>0&&(m=e.tags.some(h=>{if(!h)return!1;const c=h.toLowerCase(),x=c.replace(/\s+/g,""),y=c.replace(/\s+/g,"-"),G=c.replace(/-/g,""),S=t.replace(/\s+/g,""),v=t.replace(/\s+/g,"-");return t.length>=2&&c.includes(t)||S.length>=2&&x.includes(S)||v.length>=2&&y.includes(v)||t.length>=2&&G.includes(t)||t.length>=2&&t.includes(c)||S.length>=2&&S.includes(x)||v.length>=2&&v.includes(y)})),i||M||m})},[g,n,l]),U=t=>{f(t),F(t.name),d(!1),b([]),z(o=>({...o,[t.name.toLowerCase()]:t}))},Y=()=>{r.trim()&&r.trim().length>=2&&j.length>0&&d(!0)},O=()=>{setTimeout(()=>{d(!1)},200)};return a.jsxs("div",{style:{minHeight:"100vh",background:"var(--bg-cream)",padding:"20px"},children:[w&&a.jsx(Z,{message:w.message,type:w.type,onClose:()=>I(null)}),a.jsx(C.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},style:{textAlign:"center",marginBottom:"30px"},children:n.trim()?a.jsxs(a.Fragment,{children:[a.jsx("h1",{style:{fontSize:"2rem",fontWeight:"900",color:"var(--primary)",marginBottom:"10px"},children:l?"Nearby Spots":"Search Results"}),a.jsx("p",{style:{color:"var(--text-muted)",fontSize:"1rem"},children:l?`Showing ${p.length} spots within 30km of "${n}"`:`Showing ${p.length} spots for "${n}"`})]}):a.jsxs(a.Fragment,{children:[a.jsx("h1",{style:{fontSize:"2rem",fontWeight:"900",color:"var(--primary)",marginBottom:"10px"},children:"Explore All Spots"}),a.jsx("p",{style:{color:"var(--text-muted)",fontSize:"1rem"},children:"Discover amazing food spots across Kerala"})]})}),a.jsxs(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},style:{background:"white",padding:"20px",borderRadius:"20px",boxShadow:"var(--shadow-md)",marginBottom:"30px"},children:[a.jsx("div",{style:{display:"flex",gap:"12px",marginBottom:"16px"},children:a.jsxs("div",{style:{flex:1,position:"relative"},children:[a.jsx(tt,{size:20,color:"var(--text-muted)",style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)"}}),a.jsx("input",{type:"text",placeholder:"Search dishes, restaurants, tags, locations...",value:r,onChange:t=>F(t.target.value),onFocus:Y,onBlur:O,style:{width:"100%",padding:"12px 12px 12px 40px",borderRadius:"16px",border:"2px solid var(--secondary)",background:"var(--bg-cream)",fontSize:"1rem",outline:"none"}}),W&&j.length>0&&a.jsx("div",{style:{position:"absolute",top:"100%",left:"0",right:"0",background:"white",border:"2px solid var(--secondary)",borderTop:"none",borderRadius:"0 0 16px 16px",maxHeight:"200px",overflowY:"auto",zIndex:1e3,boxShadow:"var(--shadow-md)"},children:j.map((t,o)=>a.jsxs("div",{onClick:()=>U(t),onMouseDown:e=>e.preventDefault(),style:{padding:"12px 16px",cursor:"pointer",borderBottom:"1px solid var(--border)",transition:"background-color 0.2s",display:"flex",alignItems:"center",gap:"8px"},onMouseEnter:e=>e.target.style.backgroundColor="var(--bg-cream)",onMouseLeave:e=>e.target.style.backgroundColor="white",children:[a.jsx(et,{size:16,color:"var(--primary)"}),a.jsxs("div",{children:[a.jsx("div",{style:{fontWeight:"600",color:"var(--text-main)",fontSize:"0.9rem"},children:t.name}),a.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-muted)",marginTop:"2px"},children:t.display_name.split(",").slice(1).join(",").trim()})]})]},o))})]})}),n.trim()&&n.trim().length>=2&&a.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-muted)",marginTop:"8px",fontStyle:"italic"},children:B?"Detecting location...":l?`Found ${p.length} spots within 30km of "${n}"`:`Found ${p.length} results for "${n}"`})]}),a.jsx(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.8},children:a.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"16px"},children:_?Array.from({length:6}).map((t,o)=>a.jsx(X,{type:"card"},`skeleton-${o}`)):p.map(t=>a.jsx(Q,{spot:t,lang:D},t.id))})})]})};export{jt as default};
