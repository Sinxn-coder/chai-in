import{j as e,m as c}from"./framer-BMT5hQ7X.js";import{u as Q,r as n}from"./router-DOtJe_Np.js";import{u as Z,s as u,F as ee}from"./index-CoKeMa3F.js";import{S as L}from"./SpotCard-q6PQFzYv.js";import{a as S,M as P,X as te,T as oe,b as ae}from"./lucide-DqyMvtym.js";import"./vendor-b0vXyz-r.js";import"./supabase-CtFrdYha.js";import"./ImageSlider-D9DlSLMK.js";const me=({lang:q})=>{const D=Q(),{user:V}=Z(),[f,U]=n.useState([]),[T,M]=n.useState(!0),[r,W]=n.useState(""),[s,k]=n.useState(null),[b,I]=n.useState("All Kerala"),[G,_]=n.useState(!1),[g,C]=n.useState(""),[y,$]=n.useState(!1),[A,O]=n.useState([]),[B,X]=n.useState([]);n.useEffect(()=>{h(),j(),w();const t=u.channel("home_spots_changes").on("postgres_changes",{event:"UPDATE",schema:"public",table:"spots",filter:"is_verified=eq.true"},a=>{console.log("Home page received real-time update:",a),a.new.is_verified&&(h(),j(),w())}).subscribe(),i=u.channel("home_ratings_changes").on("postgres_changes",{event:"*",schema:"public",table:"spot_ratings"},a=>{console.log("Home page received rating change:",a),h(),j(),w()}).subscribe(),o=a=>{console.log("Home page received custom verification event:",a.detail),h()};return window.addEventListener("spotVerified",o),()=>{t.unsubscribe(),i.unsubscribe(),window.removeEventListener("spotVerified",o)}},[s]);const j=async()=>{const t=new Date(Date.now()-6048e5),{data:i}=await u.from("spots").select("*, reviews(count)").eq("is_verified",!0).gte("created_at",t.toISOString()).order("reviews.count",{ascending:!1}).limit(5);O(i||[])},w=async()=>{const{data:t}=await u.from("spots").select("*").eq("is_verified",!0).order("created_at",{ascending:!1}).limit(5);X(t||[])},h=async()=>{M(!0);const{data:t,error:i}=await u.from("spots").select("*").eq("is_verified",!0).order("created_at",{ascending:!1});if(i)console.error("Error fetching spots:",i);else{console.log("Total spots fetched:",t?.length||0),t&&t.length>0&&(console.log("Sample spots data:"),t.slice(0,3).forEach((a,l)=>{console.log(`Spot ${l+1}:`,{name:a.name,tags:a.tags,location:a.location})}));let o=t||[];s&&(console.log("Active location:",s),console.log("Filtering spots within 30km..."),o=o.filter(a=>{const l=Y(s.lat,s.lng,a.latitude,a.longitude);return console.log(`Spot: ${a.name} (${a.latitude}, ${a.longitude}) - Distance: ${l.toFixed(2)}km`),l<=30}),console.log("Spots within 30km:",o.length)),U(o)}M(!1)},E=n.useMemo(()=>{if(console.log("Filtering spots with search term:",r),console.log("Total spots before filtering:",f.length),!r.trim())return console.log("No search term, returning all spots"),f;const t=r.toLowerCase().trim();console.log("Search term processed:",t);const i=f.filter(o=>{const a=o.name&&o.name.toLowerCase().includes(t),l=o.location&&o.location.toLowerCase().includes(t);let d=!1;o.tags&&Array.isArray(o.tags)&&o.tags.length>0&&(d=o.tags.some(m=>{if(!m)return!1;const p=m.toLowerCase(),v=p.replace(/\s+/g,""),R=p.replace(/\s+/g,"-"),J=p.replace(/-/g,""),z=t.replace(/\s+/g,""),N=t.replace(/\s+/g,"-"),K=p.includes(t)||v.includes(z)||R.includes(N)||J.includes(z)||t.includes(p)||z.includes(v)||N.includes(R);return K&&console.log(`Tag match: "${m}" matches "${r}"`),K}));const x=a||l||d;return x&&(console.log(`Spot matched: "${o.name}" - Name: ${a}, Location: ${l}, Tags: ${d}`),console.log("Spot details:",{name:o.name,tags:o.tags,location:o.location})),x});return console.log("Filtered spots count:",i.length),i},[f,r]);function Y(t,i,o,a){var l=6371,d=(o-t)*Math.PI/180,x=(a-i)*Math.PI/180,m=Math.sin(d/2)*Math.sin(d/2)+Math.cos(t*Math.PI/180)*Math.cos(o*Math.PI/180)*Math.sin(x/2)*Math.sin(x/2),p=2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m)),v=l*p;return v}const F=async()=>{if(g.trim()){$(!0);try{const i=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(g+", Kerala, India")}&limit=1`)).json();if(i&&i.length>0){const o={lat:parseFloat(i[0].lat),lng:parseFloat(i[0].lon),name:i[0].display_name.split(",")[0]};console.log("Location found:",o),k(o),I(o.name),_(!1),h()}else console.log("No location found for:",g)}catch(t){console.error("Error searching location:",t)}finally{$(!1)}}},H=()=>{k(null),I("All Kerala"),C("")};return e.jsx("div",{style:{paddingBottom:"100px",background:"var(--bg-main)",minHeight:"100vh"},children:e.jsxs("div",{className:"container",style:{padding:"0 16px",maxWidth:"100%",boxSizing:"border-box"},children:[e.jsxs("header",{style:{marginBottom:"24px"},children:[e.jsxs("p",{style:{margin:0,fontSize:"1rem",color:"var(--text-muted)"},children:["Hello ",V?.user_metadata?.full_name?.split(" ")[0]||"Foodie",","]}),e.jsx("h1",{style:{margin:"4px 0",fontSize:"1.6rem",fontWeight:"900",color:"var(--text-main)"},children:"What do you want to eat today?"})]}),e.jsxs("div",{style:{position:"relative",marginBottom:"24px"},children:[e.jsx("input",{type:"text",placeholder:"Search dishes, restaurants...",value:r,onChange:t=>{const i=t.target.value;i==="#admin"?(D(`/${q}/admin`),W("")):W(i)},style:{width:"100%",padding:"16px 20px 16px 50px",borderRadius:"var(--radius-lg)",border:"none",background:"var(--secondary)",fontSize:"1rem",fontWeight:"600"}}),e.jsx(S,{size:22,color:"var(--text-muted)",style:{position:"absolute",left:"16px",top:"50%",transform:"translateY(-50%)"}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"20px"},children:[e.jsxs(c.button,{whileTap:{scale:.95},onClick:()=>_(!G),style:{background:"rgba(239, 42, 57, 0.1)",color:"var(--primary)",padding:"8px 16px",borderRadius:"12px",fontSize:"0.85rem",fontWeight:"800",display:"flex",alignItems:"center",gap:"6px",border:"none",cursor:"pointer",transition:"all 0.3s ease",flexShrink:0},children:[e.jsx(P,{size:16})," ",b]}),e.jsx("div",{style:{flex:1,minWidth:"200px"},children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:"text",placeholder:"Search location in Kerala...",value:g,onChange:t=>C(t.target.value),onKeyPress:t=>t.key==="Enter"&&F(),style:{width:"100%",padding:"0 70px 0 45px",borderRadius:"25px",border:"2px solid var(--primary)",background:"var(--bg-white)",fontSize:"0.85rem",fontWeight:"600",boxShadow:"0 4px 15px rgba(239, 42, 57, 0.15)",transition:"all 0.3s ease",boxSizing:"border-box",lineHeight:"44px"}}),e.jsx(S,{size:20,color:"var(--primary)",style:{position:"absolute",left:"15px",top:"12px",zIndex:2}}),e.jsx(c.button,{whileTap:{scale:.95},onClick:F,disabled:y,style:{position:"absolute",right:"8px",top:"7px",background:"var(--primary)",color:"white",border:"none",padding:"8px 16px",borderRadius:"20px",fontSize:"0.75rem",fontWeight:"700",cursor:y?"not-allowed":"pointer",opacity:y?.6:1,boxShadow:"0 2px 8px rgba(239, 42, 57, 0.3)",zIndex:2,height:"30px"},children:y?"...":"Go"}),g&&e.jsx(c.button,{whileTap:{scale:.95},onClick:H,style:{position:"absolute",right:"70px",top:"7px",background:"transparent",color:"#6b7280",border:"none",padding:"8px",borderRadius:"20px",fontSize:"0.75rem",fontWeight:"700",cursor:"pointer",zIndex:2,height:"30px"},children:e.jsx(te,{size:16})})]})})]}),A.length>0&&!s&&!r.trim()&&e.jsxs(c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},style:{marginBottom:"30px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[e.jsx(oe,{size:24,color:"var(--primary)"}),e.jsx("h3",{style:{fontSize:"1.3rem",fontWeight:"800",color:"var(--text-main)"},children:"Trending This Week"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"16px"},children:A.map(t=>e.jsx(L,{spot:t},t.id))})]}),B.length>0&&!s&&!r.trim()&&e.jsxs(c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.6},style:{marginBottom:"30px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[e.jsx(ae,{size:24,color:"var(--primary)"}),e.jsx("h3",{style:{fontSize:"1.3rem",fontWeight:"800",color:"var(--text-main)"},children:"Popular Spots"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"16px"},children:B.map(t=>e.jsx(L,{spot:t},t.id))})]}),T?e.jsx(ee,{}):E.length>0?e.jsxs(c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.8},children:[!s&&!r.trim()&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[e.jsx(S,{size:24,color:"var(--primary)"}),e.jsx("h3",{style:{fontSize:"1.3rem",fontWeight:"800",color:"var(--text-main)"},children:"All Spots"})]}),!s&&r.trim()&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[e.jsx(S,{size:24,color:"var(--primary)"}),e.jsxs("h3",{style:{fontSize:"1.3rem",fontWeight:"800",color:"var(--text-main)"},children:['Search Results for "',r,'"']})]}),s&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[e.jsx(P,{size:24,color:"var(--primary)"}),e.jsxs("h3",{style:{fontSize:"1.3rem",fontWeight:"800",color:"var(--text-main)"},children:["Spots within 30km of ",b]})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"16px"},children:E.map(t=>e.jsx(L,{spot:t},t.id))})]}):!T&&e.jsxs(c.div,{initial:{opacity:0},animate:{opacity:1},style:{textAlign:"center",padding:"60px 20px"},children:[e.jsx("p",{style:{fontSize:"1.1rem",color:"var(--text-muted)",marginBottom:"16px"},children:s?`No spots found within 30km of ${b}`:"No spots found matching your search"}),s&&e.jsx(c.button,{whileTap:{scale:.95},onClick:H,style:{background:"var(--primary)",color:"white",padding:"12px 24px",borderRadius:"12px",border:"none",fontSize:"0.9rem",fontWeight:"600",cursor:"pointer"},children:"Show All Kerala Spots"})]})]})})};export{me as default};
