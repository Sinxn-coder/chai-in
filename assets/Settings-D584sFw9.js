import{j as e,m as b}from"./framer-BMT5hQ7X.js";import{u as D,r as n}from"./router-DOtJe_Np.js";import{u as R,s as o}from"./index-DkTNsqGA.js";import{T as C}from"./Toast-CYAYaQvg.js";import{l as U,I as z,U as w,m as W,n as E}from"./lucide-DBAHIzol.js";import"./vendor-b0vXyz-r.js";import"./supabase-CtFrdYha.js";const F=()=>{const{user:s}=R(),g=D(),[j,u]=n.useState(!0),[y,c]=n.useState(!1),[I,x]=n.useState(!1),[m,r]=n.useState(null),[a,p]=n.useState({displayName:"",avatarUrl:"",notificationsEnabled:!0,notifyNewSpots:!0,notifyReviewReplies:!0,notifyWeeklyDigest:!1,lastDisplayNameChange:null});n.useEffect(()=>{s&&_()},[s]);const _=async()=>{u(!0);const{data:t}=await o.from("user_preferences").select("*").eq("user_id",s.id).single();t&&p({displayName:t.display_name||s.user_metadata?.full_name||"",avatarUrl:t.avatar_url||s.user_metadata?.avatar_url||"",notificationsEnabled:t.notifications_enabled,notifyNewSpots:t.notify_new_spots,notifyReviewReplies:t.notify_review_replies,notifyWeeklyDigest:t.notify_weekly_digest,lastDisplayNameChange:t.last_display_name_change}),u(!1)},S=async t=>{const i=t.target.files[0];if(i){x(!0);try{const l=`${s.id}-${Date.now()}.${i.name.split(".").pop()}`;await o.storage.from("avatars").upload(`avatars/${l}`,i);const{data:{publicUrl:h}}=o.storage.from("avatars").getPublicUrl(`avatars/${l}`);p({...a,avatarUrl:h}),r({message:"Avatar updated! Ready to save.",type:"success"})}catch{r({message:"Upload failed",type:"error"})}finally{x(!1)}}},N=async()=>{c(!0);const{data:t}=await o.from("user_preferences").select("display_name").eq("user_id",s.id).single(),i=t?.display_name!==a.displayName;if(i){const d=new Date,f=a.lastDisplayNameChange?new Date(a.lastDisplayNameChange):null,v=f?(d-f)/(1e3*60*60):25;if(v<24){const k=Math.ceil(24-v);r({message:`You can only change your display name once every 24 hours. Please wait ${k} more hours. Profile picture can be changed anytime!`,type:"error"}),c(!1);return}}if(i){const{data:d}=await o.from("user_preferences").select("display_name").eq("display_name",a.displayName).not("user_id","eq",s.id).maybeSingle();if(d){r({message:"This display name is already taken.",type:"error"}),c(!1);return}}const l=new Date,h={user_id:s.id,display_name:a.displayName,avatar_url:a.avatarUrl,notifications_enabled:a.notificationsEnabled,notify_new_spots:a.notifyNewSpots,notify_review_replies:a.notifyReviewReplies,notify_weekly_digest:a.notifyWeeklyDigest,last_display_name_change:i?l.toISOString():a.lastDisplayNameChange};try{await o.from("user_preferences").upsert(h,{onConflict:"user_id"}),window.dispatchEvent(new CustomEvent("userProfileUpdated",{detail:{displayName:a.displayName,avatarUrl:a.avatarUrl}})),r({message:i?"Settings saved successfully! Display name updated âœ¨":"Profile picture updated successfully! ðŸ“¸",type:"success"}),setTimeout(()=>g(-1),1500)}catch{r({message:"Failed to save",type:"error"})}finally{c(!1)}};return e.jsxs("div",{style:{minHeight:"100vh",background:"var(--secondary)",paddingBottom:"120px"},children:[m&&e.jsx(C,{message:m.message,type:m.type,onClose:()=>r(null)}),e.jsxs("div",{style:{height:"140px",background:"var(--primary)",borderBottomLeftRadius:"40px",borderBottomRightRadius:"40px",padding:"24px",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[e.jsx("button",{onClick:()=>g(-1),style:{position:"absolute",left:"20px",background:"rgba(255,255,255,0.2)",border:"none",padding:"10px",borderRadius:"15px",color:"white"},children:e.jsx(U,{size:24})}),e.jsx("h1",{style:{color:"white",fontWeight:"900",fontSize:"1.4rem",margin:0},children:"App Settings"})]}),e.jsx("div",{className:"container",style:{padding:"0 20px",marginTop:"-40px"},children:j?e.jsx("div",{style:{textAlign:"center",padding:"40px"},children:e.jsx(b.div,{animate:{rotate:360},transition:{repeat:1/0,duration:1},children:e.jsx(z,{size:30,color:"var(--primary)"})})}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:[e.jsxs("div",{style:{background:"white",borderRadius:"32px",padding:"24px",boxShadow:"var(--shadow-md)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"20px"},children:[e.jsx(w,{size:20,color:"var(--primary)"}),e.jsx("h2",{style:{fontSize:"1.1rem",fontWeight:"900",color:"var(--text-main)",margin:0},children:"Account Details"})]}),e.jsx("div",{style:{textAlign:"center",marginBottom:"24px"},children:e.jsxs("div",{style:{position:"relative",display:"inline-block"},children:[e.jsx("div",{style:{width:"100px",height:"100px",borderRadius:"32px",border:"4px solid var(--secondary)",overflow:"hidden",boxShadow:"var(--shadow-sm)"},children:a.avatarUrl?e.jsx("img",{src:a.avatarUrl,style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"var(--secondary)"},children:e.jsx(w,{size:40,color:"var(--text-muted)"})})}),e.jsx("label",{htmlFor:"avatar-upload",style:{position:"absolute",bottom:"-5px",right:"-5px",background:"var(--primary)",color:"white",padding:"8px",borderRadius:"12px",cursor:"pointer",boxShadow:"var(--shadow-md)"},children:e.jsx(W,{size:18})}),e.jsx("input",{id:"avatar-upload",type:"file",accept:"image/*",onChange:S,style:{display:"none"}})]})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"0.8rem",fontWeight:"800",color:"var(--text-muted)",marginBottom:"8px",display:"block"},children:"DISPLAY NAME"}),e.jsx("input",{type:"text",value:a.displayName,onChange:t=>p({...a,displayName:t.target.value}),style:{width:"100%",padding:"14px",borderRadius:"16px",background:"var(--secondary)",border:"none",fontWeight:"700",outline:"none"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"0.8rem",fontWeight:"800",color:"var(--text-muted)",marginBottom:"8px",display:"block"},children:"EMAIL ADDRESS"}),e.jsx("div",{style:{width:"100%",padding:"14px",borderRadius:"16px",background:"var(--secondary)",color:"var(--text-muted)",fontWeight:"700",opacity:.8},children:s?.email})]})]})]}),e.jsxs("div",{style:{background:"white",borderRadius:"32px",padding:"24px",boxShadow:"var(--shadow-md)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"20px"},children:[e.jsx(E,{size:20,color:"var(--primary)"}),e.jsx("h2",{style:{fontSize:"1.1rem",fontWeight:"900",color:"var(--text-main)",margin:0},children:"Notifications"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[{id:"notificationsEnabled",label:"Push Notifications",desc:"Main alert switch"},{id:"notifyNewSpots",label:"New Spots",desc:"Alerts for nearby additions"},{id:"notifyReviewReplies",label:"Review Replies",desc:"When someone chats back"}].map(t=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"800",fontSize:"0.95rem"},children:t.label}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-muted)",fontWeight:"600"},children:t.desc})]}),e.jsx("input",{type:"checkbox",checked:a[t.id],onChange:i=>p({...a,[t.id]:i.target.checked}),style:{width:"22px",height:"22px",accentColor:"var(--primary)"}})]},t.id))})]}),e.jsx(b.button,{whileTap:{scale:.95},onClick:N,disabled:y,style:{width:"100%",padding:"20px",borderRadius:"24px",background:"var(--primary)",color:"white",border:"none",fontWeight:"900",fontSize:"1rem",boxShadow:"var(--shadow-md)",opacity:y?.6:1},children:y?"Saving...":"Save Settings âœ¨"})]})})]})};export{F as default};
