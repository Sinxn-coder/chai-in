import{j as a,m as j}from"./framer-BMT5hQ7X.js";import{u as P,r as o}from"./router-DOtJe_Np.js";import{s as M}from"./index-Kf9yRKJ-.js";import{S as q}from"./SpotCard-DZ5_-FMC.js";import{S as H}from"./SkeletonLoader-D7onCYtA.js";import{T as V}from"./Toast-BwML1H3D.js";import{a as O}from"./lucide-DqyMvtym.js";import"./vendor-b0vXyz-r.js";import"./supabase-CtFrdYha.js";import"./ImageSlider-D9DlSLMK.js";const gt=({lang:C})=>{P();const[p,F]=o.useState([]),[$,g]=o.useState(!0),[x,_]=o.useState(""),[U,A]=o.useState([]),[Y,D]=o.useState([]),[v,T]=o.useState(null),[G,J]=o.useState(null),[Q,X]=o.useState("All Kerala"),[Z,tt]=o.useState(!1),[et,at]=o.useState(""),[E,b]=o.useState(!1),[c,w]=o.useState([]),[L,W]=o.useState({}),[r,z]=o.useState("");o.useEffect(()=>{const t=setTimeout(()=>{z(x)},300);return()=>clearTimeout(t)},[x]),o.useEffect(()=>{(async()=>{g(!0);try{await Promise.all([I(),k(),R()])}finally{g(!1)}})()},[]),o.useEffect(()=>{(async()=>{if(r.trim()&&r.trim().length>=2){const n=r.toLowerCase();if(L[n]){w(L[n]);return}b(!0);const e=await K(r);w(e),e.length>0&&W(s=>({...s,[n]:e})),b(!1)}else w([])})()},[r,L]);const I=async()=>{g(!0);const{data:t,error:n}=await M.from("spots").select("*").eq("is_verified",!0).order("created_at",{ascending:!1});n?(console.error("Error fetching spots:",n),T({message:"Failed to load spots",type:"error"})):F(t||[]),g(!1)},k=async()=>{const t=new Date(Date.now()-6048e5),{data:n}=await M.from("spots").select("*").eq("is_verified",!0).gte("created_at",t.toISOString()).order("created_at",{ascending:!1}).limit(5);A(n||[])},R=async()=>{const{data:t}=await M.from("spots").select("*").eq("is_verified",!0).order("created_at",{ascending:!1}).limit(5);D(t||[])};function B(t,n,e,s){var d=6371,l=(e-t)*Math.PI/180,m=(s-n)*Math.PI/180,i=Math.sin(l/2)*Math.sin(l/2)+Math.cos(t*Math.PI/180)*Math.cos(e*Math.PI/180)*Math.sin(m/2)*Math.sin(m/2),u=2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)),f=d*u;return f}const K=async t=>{if(!t||t.length<2)return[];try{const e=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(t+"*")+", Kerala, India"}&limit=10&addressdetails=1&featuretype=city`)).json();if(e&&e.length>0)return e.map(s=>({display_name:s.display_name,lat:parseFloat(s.lat),lng:parseFloat(s.lon),name:s.address?.city||s.address?.town||s.address?.village||s.display_name.split(",")[0].trim()})).filter(s=>{const d=s.name.toLowerCase(),l=t.toLowerCase();return d.startsWith(l)})}catch(n){console.error("Error getting locations:",n)}return[]},h=o.useMemo(()=>{if(!r.trim()||r.trim().length<2)return p;const t=r.toLowerCase().trim();return c.length>0?p.filter(e=>c.some(s=>B(e.latitude,e.longitude,s.lat,s.lng)<=30)):p.filter(e=>{const s=e.name&&e.name.toLowerCase().includes(t),d=e.location&&e.location.toLowerCase().includes(t);let l=!1;return e.tags&&Array.isArray(e.tags)&&e.tags.length>0&&(l=e.tags.some(m=>{if(!m)return!1;const i=m.toLowerCase(),u=i.replace(/\s+/g,""),f=i.replace(/\s+/g,"-"),N=i.replace(/-/g,""),y=t.replace(/\s+/g,""),S=t.replace(/\s+/g,"-");return t.length>=2&&i.includes(t)||y.length>=2&&u.includes(y)||S.length>=2&&f.includes(S)||t.length>=2&&N.includes(t)||t.length>=2&&t.includes(i)||y.length>=2&&y.includes(u)||S.length>=2&&S.includes(f)})),s||d||l})},[p,r,c]);return a.jsxs("div",{style:{minHeight:"100vh",background:"var(--bg-cream)",padding:"20px"},children:[v&&a.jsx(V,{message:v.message,type:v.type,onClose:()=>T(null)}),a.jsx(j.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},style:{textAlign:"center",marginBottom:"30px"},children:r.trim()?a.jsxs(a.Fragment,{children:[a.jsx("h1",{style:{fontSize:"2rem",fontWeight:"900",color:"var(--primary)",marginBottom:"10px"},children:c.length>0?"Nearby Spots":"Search Results"}),a.jsx("p",{style:{color:"var(--text-muted)",fontSize:"1rem"},children:c.length>0?`Showing ${h.length} spots within 30km of locations starting with "${r}"`:`Showing ${h.length} spots for "${r}"`})]}):a.jsxs(a.Fragment,{children:[a.jsx("h1",{style:{fontSize:"2rem",fontWeight:"900",color:"var(--primary)",marginBottom:"10px"},children:"Explore All Spots"}),a.jsx("p",{style:{color:"var(--text-muted)",fontSize:"1rem"},children:"Discover amazing food spots across Kerala"})]})}),a.jsxs(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},style:{background:"white",padding:"20px",borderRadius:"20px",boxShadow:"var(--shadow-md)",marginBottom:"30px"},children:[a.jsx("div",{style:{display:"flex",gap:"12px",marginBottom:"16px"},children:a.jsxs("div",{style:{flex:1,position:"relative"},children:[a.jsx(O,{size:20,color:"var(--text-muted)",style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)"}}),a.jsx("input",{type:"text",placeholder:"Search dishes, restaurants, tags, locations...",value:x,onChange:t=>_(t.target.value),style:{width:"100%",padding:"12px 12px 12px 40px",borderRadius:"16px",border:"2px solid var(--secondary)",background:"var(--bg-cream)",fontSize:"1rem",outline:"none"}})]})}),r.trim()&&r.trim().length>=2&&a.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-muted)",marginTop:"8px",fontStyle:"italic"},children:E?`Finding locations starting with "${r}"...`:c.length>0?`Found ${h.length} spots within 30km of ${c.length} location(s) starting with "${r}"`:`Found ${h.length} results for "${r}"`})]}),a.jsx(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.8},children:a.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"16px"},children:$?Array.from({length:6}).map((t,n)=>a.jsx(H,{type:"card"},`skeleton-${n}`)):h.map(t=>a.jsx(q,{spot:t,lang:C},t.id))})})]})};export{gt as default};
