import{j as e,m as d}from"./framer-BMT5hQ7X.js";import{u as Y,r as i}from"./router-DOtJe_Np.js";import{u as J,s as x,F as Q}from"./index-DB8Anl3c.js";import{S as W}from"./SpotCard-CJcr1ELr.js";import{S as Z}from"./SkeletonLoader-D7onCYtA.js";import{a as b,M as q,X as ee,T as te,b as ae}from"./lucide-DqyMvtym.js";import"./vendor-b0vXyz-r.js";import"./supabase-CtFrdYha.js";import"./ImageSlider-D9DlSLMK.js";const me=({lang:D})=>{const N=Y(),{user:F}=J(),[j,V]=i.useState([]),[w,_]=i.useState(!0),[n,k]=i.useState(""),[s,T]=i.useState(null),[z,I]=i.useState("All Kerala"),[$,C]=i.useState(!1),[p,A]=i.useState(""),[u,B]=i.useState(!1),[H,U]=i.useState([]),[R,G]=i.useState([]);i.useEffect(()=>{(async()=>{_(!0);try{await Promise.all([h(),L(),M()])}finally{_(!1)}})();const o=x.channel("home_spots_changes").on("postgres_changes",{event:"UPDATE",schema:"public",table:"spots",filter:"is_verified=eq.true"},r=>{console.log("Home page received real-time update:",r),r.new.is_verified&&(h(),L(),M())}).subscribe(),a=x.channel("home_ratings_changes").on("postgres_changes",{event:"*",schema:"public",table:"spot_ratings"},r=>{console.log("Home page received rating change:",r),h(),L(),M()}).subscribe(),l=r=>{console.log("Home page received custom verification event:",r.detail),h()};return window.addEventListener("spotVerified",l),()=>{o.unsubscribe(),a.unsubscribe(),window.removeEventListener("spotVerified",l)}},[s]);const L=async()=>{const t=new Date(Date.now()-6048e5),{data:o}=await x.from("spots").select("*").eq("is_verified",!0).gte("created_at",t.toISOString()).order("created_at",{ascending:!1}).limit(5);U(o||[])},M=async()=>{const{data:t}=await x.from("spots").select("*").eq("is_verified",!0).order("created_at",{ascending:!1}).limit(5);G(t||[])},h=async()=>{const{data:t,error:o}=await x.from("spots").select("*").eq("is_verified",!0).order("created_at",{ascending:!1});if(o)console.error("Error fetching spots:",o);else{let a=t||[];s&&(a=a.filter(l=>O(s.lat,s.lng,l.latitude,l.longitude)<=30)),V(a)}},E=i.useMemo(()=>{if(!n.trim()||n.trim().length<2)return j;const t=n.toLowerCase().trim();return j.filter(a=>{const l=a.name&&a.name.toLowerCase().includes(t),r=a.location&&a.location.toLowerCase().includes(t);let m=!1;return a.tags&&Array.isArray(a.tags)&&a.tags.length>0&&(m=a.tags.some(g=>{if(!g)return!1;const c=g.toLowerCase(),f=c.replace(/\s+/g,""),y=c.replace(/\s+/g,"-"),X=c.replace(/-/g,""),v=t.replace(/\s+/g,""),S=t.replace(/\s+/g,"-");return t.length>=2&&c.includes(t)||v.length>=2&&f.includes(v)||S.length>=2&&y.includes(S)||t.length>=2&&X.includes(t)||t.length>=2&&t.includes(c)||v.length>=2&&v.includes(f)||S.length>=2&&S.includes(y)})),l||r||m})},[j,n]);function O(t,o,a,l){var r=6371,m=(a-t)*Math.PI/180,g=(l-o)*Math.PI/180,c=Math.sin(m/2)*Math.sin(m/2)+Math.cos(t*Math.PI/180)*Math.cos(a*Math.PI/180)*Math.sin(g/2)*Math.sin(g/2),f=2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),y=r*f;return y}const P=async()=>{if(p.trim()){B(!0);try{const o=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(p+", Kerala, India")}&limit=1`)).json();if(o&&o.length>0){const a={lat:parseFloat(o[0].lat),lng:parseFloat(o[0].lon),name:o[0].display_name.split(",")[0]};console.log("Location found:",a),T(a),I(a.name),C(!1),h()}else console.log("No location found for:",p)}catch(t){console.error("Error searching location:",t)}finally{B(!1)}}},K=()=>{T(null),I("All Kerala"),A("")};return e.jsx("div",{style:{paddingBottom:"100px",background:"var(--bg-main)",minHeight:"100vh"},children:e.jsxs("div",{className:"container",style:{padding:"0 16px",maxWidth:"100%",boxSizing:"border-box"},children:[e.jsxs("header",{style:{marginBottom:"24px"},children:[e.jsxs("p",{style:{margin:0,fontSize:"1rem",color:"var(--text-muted)"},children:["Hello ",F?.user_metadata?.full_name?.split(" ")[0]||"Foodie",","]}),e.jsx("h1",{style:{margin:"4px 0",fontSize:"1.6rem",fontWeight:"900",color:"var(--text-main)"},children:"What do you want to eat today?"})]}),e.jsxs("div",{style:{position:"relative",marginBottom:"24px"},children:[e.jsx("input",{type:"text",placeholder:"Search dishes, restaurants...",value:n,onChange:t=>{const o=t.target.value;o==="#admin"?(N(`/${D}/admin`),k("")):k(o)},style:{width:"100%",padding:"16px 20px 16px 50px",borderRadius:"var(--radius-lg)",border:"none",background:"var(--secondary)",fontSize:"1rem",fontWeight:"600"}}),e.jsx(b,{size:22,color:"var(--text-muted)",style:{position:"absolute",left:"16px",top:"50%",transform:"translateY(-50%)"}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"20px"},children:[e.jsxs(d.button,{whileTap:{scale:.95},onClick:()=>C(!$),style:{background:"rgba(239, 42, 57, 0.1)",color:"var(--primary)",padding:"8px 16px",borderRadius:"12px",fontSize:"0.85rem",fontWeight:"800",display:"flex",alignItems:"center",gap:"6px",border:"none",cursor:"pointer",transition:"all 0.3s ease",flexShrink:0},children:[e.jsx(q,{size:16})," ",z]}),e.jsx("div",{style:{flex:1,minWidth:"200px"},children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:"text",placeholder:"Search location in Kerala...",value:p,onChange:t=>A(t.target.value),onKeyPress:t=>t.key==="Enter"&&P(),style:{width:"100%",padding:"0 70px 0 45px",borderRadius:"25px",border:"2px solid var(--primary)",background:"var(--bg-white)",fontSize:"0.85rem",fontWeight:"600",boxShadow:"0 4px 15px rgba(239, 42, 57, 0.15)",transition:"all 0.3s ease",boxSizing:"border-box",lineHeight:"44px"}}),e.jsx(b,{size:20,color:"var(--primary)",style:{position:"absolute",left:"15px",top:"12px",zIndex:2}}),e.jsx(d.button,{whileTap:{scale:.95},onClick:P,disabled:u,style:{position:"absolute",right:"8px",top:"7px",background:"var(--primary)",color:"white",border:"none",padding:"8px 16px",borderRadius:"20px",fontSize:"0.75rem",fontWeight:"700",cursor:u?"not-allowed":"pointer",opacity:u?.6:1,boxShadow:"0 2px 8px rgba(239, 42, 57, 0.3)",zIndex:2,height:"30px"},children:u?"...":"Go"}),p&&e.jsx(d.button,{whileTap:{scale:.95},onClick:K,style:{position:"absolute",right:"70px",top:"7px",background:"transparent",color:"#6b7280",border:"none",padding:"8px",borderRadius:"20px",fontSize:"0.75rem",fontWeight:"700",cursor:"pointer",zIndex:2,height:"30px"},children:e.jsx(ee,{size:16})})]})})]}),H.length>0&&!s&&!n.trim()&&e.jsxs(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},style:{marginBottom:"30px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[e.jsx(te,{size:24,color:"var(--primary)"}),e.jsx("h3",{style:{fontSize:"1.3rem",fontWeight:"800",color:"var(--text-main)"},children:"Trending This Week"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"16px"},children:H.map(t=>e.jsx(W,{spot:t},t.id))})]}),R.length>0&&!s&&!n.trim()&&e.jsxs(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.6},style:{marginBottom:"30px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[e.jsx(ae,{size:24,color:"var(--primary)"}),e.jsx("h3",{style:{fontSize:"1.3rem",fontWeight:"800",color:"var(--text-main)"},children:"Popular Spots"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"16px"},children:R.map(t=>e.jsx(W,{spot:t},t.id))})]}),w?e.jsx(Q,{}):E.length>0?e.jsxs(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.8},children:[!s&&!n.trim()&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[e.jsx(b,{size:24,color:"var(--primary)"}),e.jsx("h3",{style:{fontSize:"1.3rem",fontWeight:"800",color:"var(--text-main)"},children:"All Spots"})]}),!s&&n.trim()&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[e.jsx(b,{size:24,color:"var(--primary)"}),e.jsxs("h3",{style:{fontSize:"1.3rem",fontWeight:"800",color:"var(--text-main)"},children:['Search Results for "',n,'"']})]}),s&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[e.jsx(q,{size:24,color:"var(--primary)"}),e.jsxs("h3",{style:{fontSize:"1.3rem",fontWeight:"800",color:"var(--text-main)"},children:["Spots within 30km of ",z]})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"16px"},children:w?Array.from({length:6}).map((t,o)=>e.jsx(Z,{type:"card"},`skeleton-${o}`)):E.map(t=>e.jsx(W,{spot:t},t.id))})]}):!w&&e.jsxs(d.div,{initial:{opacity:0},animate:{opacity:1},style:{textAlign:"center",padding:"60px 20px"},children:[e.jsx("p",{style:{fontSize:"1.1rem",color:"var(--text-muted)",marginBottom:"16px"},children:s?`No spots found within 30km of ${z}`:"No spots found matching your search"}),s&&e.jsx(d.button,{whileTap:{scale:.95},onClick:K,style:{background:"var(--primary)",color:"white",padding:"12px 24px",borderRadius:"12px",border:"none",fontSize:"0.9rem",fontWeight:"600",cursor:"pointer"},children:"Show All Kerala Spots"})]})]})})};export{me as default};
