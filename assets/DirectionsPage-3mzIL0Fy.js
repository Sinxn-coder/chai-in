import{j as e,m}from"./framer-BMT5hQ7X.js";import{d as k,u as W,r as a}from"./router-DOtJe_Np.js";import{u as I,s as o}from"./index-BVAzjCNv.js";import{M as E,Q as z}from"./lucide-DqyMvtym.js";import"./vendor-b0vXyz-r.js";import"./supabase-CtFrdYha.js";const T=({lang:u})=>{const{id:i}=k(),y=W(),{user:c}=I(),[r,f]=a.useState(null),[x,l]=a.useState([]),[d,g]=a.useState(""),[v,j]=a.useState(!0);a.useEffect(()=>{w(),p();const t=()=>{p()};return window.addEventListener("userProfileUpdated",t),()=>{window.removeEventListener("userProfileUpdated",t)}},[i]);const w=async()=>{try{const{data:t,error:n}=await o.from("spots").select("*").eq("id",parseInt(i)).single();if(n)throw n;f(t)}catch(t){console.error("Error fetching spot:",t)}finally{j(!1)}},p=async()=>{const{data:t,error:n}=await o.from("reviews").select("*").eq("spot_id",i).order("created_at",{ascending:!1});if(n){console.error("Error loading reviews:",n),l([]);return}if(t){const _=[...new Set(t.map(s=>s.user_id))],{data:R}=await o.from("user_preferences").select("user_id, display_name, avatar_url").in("user_id",_),h={};R?.forEach(s=>h[s.user_id]=s),l(t.map(s=>({...s,user:h[s.user_id]||{display_name:"User"}})))}else l([])},b=async()=>{if(!c)return alert("Please login to submit a review!");if(!d.trim())return;const{error:t}=await o.from("reviews").insert({spot_id:parseInt(i),user_id:c.id,comment:d,rating:5});t?console.error("Error adding review:",t):(g(""),p())},S=()=>{sessionStorage.setItem("refreshSpotDetail","true"),y(`/${u}/spot/${i}`)};return v?e.jsx("div",{style:{height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"var(--bg-white)"},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{width:"40px",height:"40px",border:"4px solid var(--primary)",borderTop:"4px solid transparent",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 20px"}}),e.jsx("p",{style:{color:"var(--text-main)",fontWeight:"600"},children:"Loading directions..."})]})}):r?e.jsxs("div",{style:{minHeight:"100vh",background:"var(--bg-white)",position:"relative"},children:[e.jsx("div",{style:{background:"var(--primary)",padding:"20px",display:"flex",alignItems:"center",gap:"16px"},children:e.jsxs(m.button,{whileTap:{scale:.9},onClick:S,style:{background:"rgba(255,255,255,0.2)",border:"none",borderRadius:"12px",padding:"10px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(z,{size:20,color:"white"}),e.jsx("span",{style:{color:"white",fontWeight:"600",fontSize:"0.9rem"},children:"Go Back"})]})}),e.jsx("div",{style:{padding:"40px 20px",textAlign:"center",maxWidth:"600px",margin:"0 auto"},children:e.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsxs("div",{style:{background:"var(--secondary)",padding:"30px",borderRadius:"20px",marginBottom:"30px"},children:[e.jsx("h1",{style:{fontSize:"1.8rem",fontWeight:"900",margin:"0 0 16px 0",color:"var(--text-main)"},children:r.name}),e.jsx("p",{style:{color:"var(--text-muted)",margin:"0 0 20px 0",fontSize:"1rem"},children:r.location_text||"Kerala, India"})]}),e.jsxs("div",{style:{background:"var(--secondary)",padding:"20px",borderRadius:"16px"},children:[e.jsx("h3",{style:{margin:"0 0 12px 0",color:"var(--text-main)",fontSize:"1.1rem",fontWeight:"800"},children:"ðŸ“ Spot Information"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",textAlign:"left"},children:[r.opening_hours?.open&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:"var(--text-muted)"},children:"Hours:"}),e.jsxs("span",{style:{fontWeight:"600"},children:[r.opening_hours.open," - ",r.opening_hours.close]})]}),r.rating&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:"var(--text-muted)"},children:"Rating:"}),e.jsxs("span",{style:{fontWeight:"600"},children:["â­ ",r.rating]})]}),r.tags&&r.tags.length>0&&e.jsxs("div",{children:[e.jsx("span",{style:{color:"var(--text-muted)"},children:"Tags:"}),e.jsx("div",{style:{marginTop:"8px",display:"flex",gap:"8px",flexWrap:"wrap"},children:r.tags.map(t=>e.jsxs("span",{style:{background:"var(--primary)",color:"white",padding:"4px 8px",borderRadius:"8px",fontSize:"0.8rem",fontWeight:"600"},children:["#",t]},t))})]})]})]}),e.jsxs("div",{style:{marginBottom:"40px"},children:[e.jsxs("h2",{style:{fontSize:"1.4rem",fontWeight:"900",marginBottom:"20px"},children:["Reviews (",x.length,")"]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:x.map(t=>e.jsxs("div",{style:{display:"flex",gap:"12px"},children:[e.jsx("img",{src:t.user?.avatar_url||"https://i.pravatar.cc/40",style:{width:"40px",height:"40px",borderRadius:"50%"}}),e.jsxs("div",{children:[e.jsx("p",{style:{fontWeight:"800",margin:0},children:t.user?.display_name||"Anonymous"}),e.jsx("p",{style:{margin:"4px 0 0 0",color:"var(--text-main)"},children:t.comment})]})]},t.id))}),e.jsxs("div",{style:{marginTop:"24px",display:"flex",gap:"10px"},children:[e.jsx("input",{type:"text",value:d,onChange:t=>g(t.target.value),placeholder:"Add a review...",style:{flex:1,padding:"14px",borderRadius:"16px",border:"2px solid var(--secondary)",outline:"none",fontWeight:"700"}}),e.jsx("button",{onClick:b,style:{padding:"14px 20px",borderRadius:"16px",background:"var(--primary)",color:"white",border:"none",fontWeight:"800"},children:"Send"})]})]})]})}),e.jsx("style",{jsx:!0,children:`
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `})]}):e.jsx("div",{style:{height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"var(--bg-white)"},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(E,{size:48,color:"var(--primary)",style:{marginBottom:"20px"}}),e.jsx("h2",{style:{color:"var(--text-main)",margin:0},children:"Spot not found"})]})})};export{T as default};
