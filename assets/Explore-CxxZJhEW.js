import{j as e,m as S}from"./framer-BMT5hQ7X.js";import{u as q,r as s}from"./router-DOtJe_Np.js";import{s as v}from"./index-CzUaKm_m.js";import{S as D}from"./SpotCard-CZ2IbvHj.js";import{T as R}from"./Toast-BwML1H3D.js";import{a as k}from"./lucide-DqyMvtym.js";import"./vendor-b0vXyz-r.js";import"./supabase-CtFrdYha.js";import"./ImageSlider-D9DlSLMK.js";const ct=({lang:M})=>{q();const[p,b]=s.useState([]),[F,L]=s.useState(!0),[o,T]=s.useState(""),[B,C]=s.useState([]),[H,z]=s.useState([]),[x,j]=s.useState(null),[K,N]=s.useState(null),[P,V]=s.useState("All Kerala"),[O,U]=s.useState(!1),[Y,G]=s.useState(""),[J,Q]=s.useState(!1),[i,w]=s.useState(null);s.useEffect(()=>{$(),A(),E()},[]),s.useEffect(()=>{(async()=>{if(o.trim()&&o.trim().length>=2){const n=await W(o);w(n)}else w(null)})()},[o]);const $=async()=>{L(!0);const{data:t,error:n}=await v.from("spots").select("*").eq("is_verified",!0).order("created_at",{ascending:!1});n?(console.error("Error fetching spots:",n),j({message:"Failed to load spots",type:"error"})):b(t||[]),L(!1)},A=async()=>{const t=new Date(Date.now()-6048e5),{data:n}=await v.from("spots").select("*").eq("is_verified",!0).gte("created_at",t.toISOString()).order("created_at",{ascending:!1}).limit(5);C(n||[])},E=async()=>{const{data:t}=await v.from("spots").select("*").eq("is_verified",!0).order("created_at",{ascending:!1}).limit(5);z(t||[])};function I(t,n,a,h){var y=6371,l=(a-t)*Math.PI/180,d=(h-n)*Math.PI/180,r=Math.sin(l/2)*Math.sin(l/2)+Math.cos(t*Math.PI/180)*Math.cos(a*Math.PI/180)*Math.sin(d/2)*Math.sin(d/2),m=2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)),g=y*m;return g}const W=async t=>{try{const a=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(t+", Kerala, India")}&limit=1`)).json();if(a&&a.length>0)return{lat:parseFloat(a[0].lat),lng:parseFloat(a[0].lon)}}catch(n){console.error("Error getting location coordinates:",n)}return null},c=s.useMemo(()=>{if(!o.trim()||o.trim().length<2)return p;const t=o.toLowerCase().trim();return i?p.filter(a=>I(a.latitude,a.longitude,i.lat,i.lng)<=30):p.filter(a=>{const h=a.name&&a.name.toLowerCase().includes(t),y=a.location&&a.location.toLowerCase().includes(t);let l=!1;return a.tags&&Array.isArray(a.tags)&&a.tags.length>0&&(l=a.tags.some(d=>{if(!d)return!1;const r=d.toLowerCase(),m=r.replace(/\s+/g,""),g=r.replace(/\s+/g,"-"),_=r.replace(/-/g,""),u=t.replace(/\s+/g,""),f=t.replace(/\s+/g,"-");return t.length>=2&&r.includes(t)||u.length>=2&&m.includes(u)||f.length>=2&&g.includes(f)||t.length>=2&&_.includes(t)||t.length>=2&&t.includes(r)||u.length>=2&&u.includes(m)||f.length>=2&&f.includes(g)})),h||y||l})},[p,o,i]);return e.jsxs("div",{style:{minHeight:"100vh",background:"var(--bg-cream)",padding:"20px"},children:[x&&e.jsx(R,{message:x.message,type:x.type,onClose:()=>j(null)}),e.jsx(S.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},style:{textAlign:"center",marginBottom:"30px"},children:o.trim()?e.jsxs(e.Fragment,{children:[e.jsx("h1",{style:{fontSize:"2rem",fontWeight:"900",color:"var(--primary)",marginBottom:"10px"},children:i?"Nearby Spots":"Search Results"}),e.jsx("p",{style:{color:"var(--text-muted)",fontSize:"1rem"},children:i?`Showing ${c.length} spots within 30km of "${o}"`:`Showing ${c.length} spots for "${o}"`})]}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{style:{fontSize:"2rem",fontWeight:"900",color:"var(--primary)",marginBottom:"10px"},children:"Explore All Spots"}),e.jsx("p",{style:{color:"var(--text-muted)",fontSize:"1rem"},children:"Discover amazing food spots across Kerala"})]})}),e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},style:{background:"white",padding:"20px",borderRadius:"20px",boxShadow:"var(--shadow-md)",marginBottom:"30px"},children:[e.jsx("div",{style:{display:"flex",gap:"12px",marginBottom:"16px"},children:e.jsxs("div",{style:{flex:1,position:"relative"},children:[e.jsx(k,{size:20,color:"var(--text-muted)",style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)"}}),e.jsx("input",{type:"text",placeholder:"Search dishes, restaurants, tags, locations...",value:o,onChange:t=>T(t.target.value),style:{width:"100%",padding:"12px 12px 12px 40px",borderRadius:"16px",border:"2px solid var(--secondary)",background:"var(--bg-cream)",fontSize:"1rem",outline:"none"}})]})}),o.trim()&&o.trim().length>=2&&e.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-muted)",marginTop:"8px",fontStyle:"italic"},children:i?`Found ${c.length} spots within 30km of "${o}"`:`Found ${c.length} results for "${o}"`})]}),e.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.8},children:F?e.jsx("div",{style:{textAlign:"center",padding:"40px"},children:e.jsx("div",{style:{fontSize:"1.1rem",color:"var(--text-muted)"},children:"Loading spots..."})}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"16px"},children:c.map(t=>e.jsx(D,{spot:t,lang:M},t.id))})})]})};export{ct as default};
