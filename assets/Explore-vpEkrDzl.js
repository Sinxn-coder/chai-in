import{j as a,m as j}from"./framer-BMT5hQ7X.js";import{u as N,r as o}from"./router-DOtJe_Np.js";import{s as M}from"./index-D-UdPBaI.js";import{S as P}from"./SpotCard-zv2mAJ2R.js";import{S as q}from"./SkeletonLoader-D7onCYtA.js";import{T as H}from"./Toast-BwML1H3D.js";import{a as V}from"./lucide-DqyMvtym.js";import"./vendor-b0vXyz-r.js";import"./supabase-CtFrdYha.js";import"./ImageSlider-D9DlSLMK.js";const gt=({lang:T})=>{N();const[p,_]=o.useState([]),[A,m]=o.useState(!0),[S,F]=o.useState(""),[O,D]=o.useState([]),[U,E]=o.useState([]),[x,b]=o.useState(null),[Y,G]=o.useState(null),[J,Q]=o.useState("All Kerala"),[X,Z]=o.useState(!1),[tt,et]=o.useState(""),[at,C]=o.useState(!1),[d,v]=o.useState([]),[w,W]=o.useState({}),[n,I]=o.useState("");o.useEffect(()=>{const t=setTimeout(()=>{I(S)},300);return()=>clearTimeout(t)},[S]),o.useEffect(()=>{(async()=>{m(!0);try{await Promise.all([z(),k(),R()])}finally{m(!1)}})()},[]),o.useEffect(()=>{(async()=>{if(n.trim()&&n.trim().length>=2){const r=n.toLowerCase();if(w[r]){v(w[r]);return}C(!0);const e=await B(n);v(e),e.length>0&&W(s=>({...s,[r]:e})),C(!1)}else v([])})()},[n,w]);const z=async()=>{m(!0);const{data:t,error:r}=await M.from("spots").select("*").eq("is_verified",!0).order("created_at",{ascending:!1});r?(console.error("Error fetching spots:",r),b({message:"Failed to load spots",type:"error"})):_(t||[]),m(!1)},k=async()=>{const t=new Date(Date.now()-6048e5),{data:r}=await M.from("spots").select("*").eq("is_verified",!0).gte("created_at",t.toISOString()).order("created_at",{ascending:!1}).limit(5);D(r||[])},R=async()=>{const{data:t}=await M.from("spots").select("*").eq("is_verified",!0).order("created_at",{ascending:!1}).limit(5);E(t||[])};function $(t,r,e,s){var l=6371,c=(e-t)*Math.PI/180,h=(s-r)*Math.PI/180,i=Math.sin(c/2)*Math.sin(c/2)+Math.cos(t*Math.PI/180)*Math.cos(e*Math.PI/180)*Math.sin(h/2)*Math.sin(h/2),g=2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)),u=l*g;return u}const B=async t=>{if(!t||t.length<2)return[];try{const e=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(t+"*")+", Kerala, India"}&limit=10&addressdetails=1&featuretype=city`)).json();if(e&&e.length>0)return e.map(s=>({display_name:s.display_name,lat:parseFloat(s.lat),lng:parseFloat(s.lon),name:s.address?.city||s.address?.town||s.address?.village||s.display_name.split(",")[0].trim()})).filter(s=>{const l=s.name.toLowerCase(),c=t.toLowerCase();return l.startsWith(c)})}catch(r){console.error("Error getting locations:",r)}return[]},L=o.useMemo(()=>{if(!n.trim()||n.trim().length<2)return p;const t=n.toLowerCase().trim();return d.length>0?p.filter(e=>d.some(s=>$(e.latitude,e.longitude,s.lat,s.lng)<=30)):p.filter(e=>{const s=e.name&&e.name.toLowerCase().includes(t),l=e.location&&e.location.toLowerCase().includes(t);let c=!1;return e.tags&&Array.isArray(e.tags)&&e.tags.length>0&&(c=e.tags.some(h=>{if(!h)return!1;const i=h.toLowerCase(),g=i.replace(/\s+/g,""),u=i.replace(/\s+/g,"-"),K=i.replace(/-/g,""),f=t.replace(/\s+/g,""),y=t.replace(/\s+/g,"-");return t.length>=2&&i.includes(t)||f.length>=2&&g.includes(f)||y.length>=2&&u.includes(y)||t.length>=2&&K.includes(t)||t.length>=2&&t.includes(i)||f.length>=2&&f.includes(g)||y.length>=2&&y.includes(u)})),s||l||c})},[p,n,d]);return a.jsxs("div",{style:{minHeight:"100vh",background:"var(--bg-cream)",padding:"20px"},children:[x&&a.jsx(H,{message:x.message,type:x.type,onClose:()=>b(null)}),a.jsx(j.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},style:{textAlign:"center",marginBottom:"30px"},children:n.trim()?a.jsxs(a.Fragment,{children:[a.jsx("h1",{style:{fontSize:"2rem",fontWeight:"900",color:"var(--primary)",marginBottom:"10px"},children:d.length>0?"Nearby Spots":"Search Results"}),a.jsx("p",{style:{color:"var(--text-muted)",fontSize:"1rem"},children:d.length>0?`Showing ${L.length} spots within 30km of locations starting with "${n}"`:`Showing ${L.length} spots for "${n}"`})]}):a.jsxs(a.Fragment,{children:[a.jsx("h1",{style:{fontSize:"2rem",fontWeight:"900",color:"var(--primary)",marginBottom:"10px"},children:"Explore All Spots"}),a.jsx("p",{style:{color:"var(--text-muted)",fontSize:"1rem"},children:"Discover amazing food spots across Kerala"})]})}),a.jsx(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},style:{background:"white",padding:"20px",borderRadius:"20px",boxShadow:"var(--shadow-md)",marginBottom:"30px"},children:a.jsx("div",{style:{display:"flex",gap:"12px",marginBottom:"16px"},children:a.jsxs("div",{style:{flex:1,position:"relative"},children:[a.jsx(V,{size:20,color:"var(--text-muted)",style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)"}}),a.jsx("input",{type:"text",placeholder:"Search dishes, restaurants, tags, locations...",value:S,onChange:t=>F(t.target.value),style:{width:"100%",padding:"12px 12px 12px 40px",borderRadius:"16px",border:"2px solid var(--secondary)",background:"var(--bg-cream)",fontSize:"1rem",outline:"none"}})]})})}),a.jsx(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.8},children:a.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"16px"},children:A?Array.from({length:6}).map((t,r)=>a.jsx(q,{type:"card"},`skeleton-${r}`)):L.map(t=>a.jsx(P,{spot:t,lang:T},t.id))})})]})};export{gt as default};
