import{j as e}from"./framer-BMT5hQ7X.js";import{r as o}from"./router-DOtJe_Np.js";import{X as D,a as T,r as A,_ as P,M as U}from"./lucide-DBAHIzol.js";const W=({isOpen:p,onClose:z,onSelectLocation:I,initialCenter:f=[11.2588,75.7804]})=>{const[i,u]=o.useState(null),[b,w]=o.useState(!1),[d,R]=o.useState(!1),[x,C]=o.useState(""),[g,L]=o.useState(!1),S=o.useRef(null),a=o.useRef(null),j=o.useRef(null),m=o.useRef(null),h=o.useRef(null);o.useEffect(()=>{if(!p)return;(()=>{if(window.L){w(!0);return}if(document.getElementById("leaflet-script")){document.getElementById("leaflet-script").addEventListener("load",()=>w(!0));return}if(!document.getElementById("leaflet-css")){const l=document.createElement("link");l.id="leaflet-css",l.rel="stylesheet",l.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",document.head.appendChild(l)}const n=document.createElement("script");n.id="leaflet-script",n.src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js",n.async=!0,n.onload=()=>w(!0),document.body.appendChild(n)})()},[p]),o.useEffect(()=>{if(!(!p||!b||!S.current)){a.current&&(a.current.remove(),a.current=null);try{const t=window.L.map(S.current).setView(f,13);a.current=t;const n=window.L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"Â© OpenStreetMap contributors"}),l=window.L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EBP, and the GIS User Community"});d?l.addTo(t):n.addTo(t),m.current=n,h.current=l;const c=window.L.marker(f,{draggable:!0,icon:window.L.icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]})}).addTo(t);j.current=c,c.bindPopup("Drag me to select location!").openPopup(),c.on("dragend",function(s){const r=s.target.getLatLng();u({lat:r.lat,lng:r.lng})}),t.on("click",function(s){c.setLatLng(s.latlng),u({lat:s.latlng.lat,lng:s.latlng.lng})});const y=window.L.Control.extend({options:{position:"bottomright"},onAdd:function(s){const r=window.L.DomUtil.create("button","leaflet-bar leaflet-control leaflet-control-custom");return r.innerHTML="ðŸ“",r.style.backgroundColor="white",r.style.width="30px",r.style.height="30px",r.style.cursor="pointer",r.style.border="2px solid rgba(0,0,0,0.2)",r.style.borderRadius="4px",r.title="Locate Me",r.onclick=function(v){v.preventDefault(),v.stopPropagation(),s.locate({setView:!0,maxZoom:16})},r}});t.addControl(new y),t.on("locationfound",function(s){c.setLatLng(s.latlng),u({lat:s.latlng.lat,lng:s.latlng.lng})}),setTimeout(()=>{t.invalidateSize()},300),u({lat:f[0],lng:f[1]})}catch(t){console.error("Map initialization error:",t)}return()=>{a.current&&(a.current.remove(),a.current=null)}}},[p,b]);const E=()=>{if(!a.current||!m.current||!h.current)return;const t=a.current;d?(t.removeLayer(h.current),m.current.addTo(t)):(t.removeLayer(m.current),h.current.addTo(t)),R(!d)},k=async()=>{if(!(!x.trim()||g)){L(!0);try{const n=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(x)}`)).json();if(n&&n.length>0){const{lat:l,lon:c}=n[0],y=[parseFloat(l),parseFloat(c)];a.current&&j.current&&(a.current.setView(y,16),j.current.setLatLng(y),u({lat:parseFloat(l),lng:parseFloat(c)}))}else alert("Location not found.")}catch(t){console.error("Search error:",t)}finally{L(!1)}}},M=()=>{i&&I(i.lat,i.lng)};return p?e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.85)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem",backdropFilter:"blur(4px)"},children:e.jsxs("div",{style:{background:"white",borderRadius:"16px",width:"100%",maxWidth:"600px",height:"80vh",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"},children:[e.jsxs("div",{style:{padding:"1rem",borderBottom:"1px solid #eee",display:"flex",justifyContent:"space-between",alignItems:"center",background:"white",zIndex:10},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,fontSize:"1.2rem",fontWeight:"700",color:"#1a1a1a"},children:"ðŸ“ Select Location"}),e.jsx("p",{style:{margin:"4px 0 0 0",fontSize:"0.85rem",color:"#666"},children:"Drag pin or click map to pinpoint spot"})]}),e.jsx("button",{onClick:z,style:{background:"#f5f5f5",border:"none",borderRadius:"50%",width:"36px",height:"36px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#666",transition:"all 0.2s"},children:e.jsx(D,{size:20})})]}),e.jsxs("div",{style:{padding:"0.8rem 1rem",background:"#fff",borderBottom:"1px solid #eee",display:"flex",gap:"8px"},children:[e.jsxs("div",{style:{flex:1,position:"relative"},children:[e.jsx("input",{type:"text",placeholder:"Search location (e.g. Kozhikode)",value:x,onChange:t=>C(t.target.value),onKeyDown:t=>t.key==="Enter"&&k(),style:{width:"100%",padding:"10px 12px 10px 40px",border:"1px solid #e2e8f0",borderRadius:"10px",fontSize:"0.9rem"}}),e.jsx(T,{size:18,style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"#94a3b8"}})]}),e.jsx("button",{onClick:k,disabled:g||!x.trim(),style:{padding:"8px 16px",background:"var(--primary)",color:"white",border:"none",borderRadius:"10px",fontWeight:"600",fontSize:"0.85rem",cursor:"pointer",opacity:g?.6:1},children:g?"...":"Search"})]}),e.jsxs("div",{style:{flex:1,position:"relative"},children:[!b&&e.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"#f8fafc",zIndex:20},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"12px"},children:[e.jsx(A,{className:"animate-spin",size:32,color:"var(--primary)"}),e.jsx("span",{style:{color:"#64748b",fontWeight:"500"},children:"Loading map resources..."})]})}),e.jsxs("button",{onClick:t=>{t.preventDefault(),E()},style:{position:"absolute",top:"12px",right:"12px",zIndex:1e3,background:d?"#10b981":"white",color:d?"white":"#1e293b",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"8px 12px",display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",fontWeight:"600",fontSize:"0.85rem",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},children:[e.jsx(P,{size:16}),d?"Satellite":"Map View"]}),e.jsx("div",{ref:S,style:{width:"100%",height:"100%",background:"#e2e8f0",touchAction:"none"}})]}),e.jsxs("div",{style:{padding:"1rem",borderTop:"1px solid #eee",background:"white",zIndex:10},children:[e.jsx("div",{style:{display:"flex",gap:"12px"},children:e.jsx("div",{style:{flex:1},children:i?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",fontSize:"0.9rem",color:"#0f172a",background:"#f1f5f9",padding:"8px 12px",borderRadius:"8px",marginBottom:"12px"},children:[e.jsx(U,{size:16,className:"text-primary"}),e.jsxs("span",{children:[i.lat.toFixed(4),", ",i.lng.toFixed(4)]})]}):e.jsx("div",{style:{height:"36px"}})})}),e.jsx("button",{onClick:M,disabled:!i,style:{width:"100%",padding:"14px",background:i?"linear-gradient(135deg, #10b981 0%, #059669 100%)":"#e2e8f0",color:i?"white":"#94a3b8",border:"none",borderRadius:"12px",fontWeight:"700",fontSize:"1rem",cursor:i?"pointer":"not-allowed",transition:"all 0.2s",boxShadow:i?"0 4px 12px rgba(16, 185, 129, 0.2)":"none"},children:"Confirm Location"})]})]})}):null};export{W as M};
